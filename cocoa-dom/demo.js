!function(){"use strict";class HIAnimator{constructor(e,t,i,s){this._duration=e,this._delay=Math.max(t,0),this._startTime=-1,this._progress=0,this._timingFunction=i,this._action=s,this._finishedCallbacks=[],this._cancelledCallbacks=[],this._delayTimer=0}static _sinusoidal(e){return.5-.5*Math.cos(e*Math.PI)}static frameByFrame(e,t,i,s){switch(void 0){case i:return new HIAnimator(e,0,HIAnimator._sinusoidal,t);case s:return new HIAnimator(e,t,HIAnimator._sinusoidal,i);default:return new HIAnimator(e,t,i,s)}}then(e){return this._finishedCallbacks.push(e),this}catch(e){return this._cancelledCallbacks.push(e),this}thenOrCatch(e){return this._finishedCallbacks.push(e),this._cancelledCallbacks.push(e),this}play(){return this._startTime>=0||0!==this._delayTimer||(0===this._delay?(this._startTime=performance.now(),this._progress=0,this._update()):this._delayTimer=setTimeout(()=>{this._delayTimer=0,this._startTime=performance.now(),this._progress=0,this._update()},this._delay)),this}cancel(){if(!(this._startTime<0&&0===this._delayTimer)){clearTimeout(this._delayTimer),this._delayTimer=0,this._startTime=-1,this._progress=0;for(let e of this._cancelledCallbacks)e()}}get isAnimating(){return this._startTime>=0}get progress(){return this._progress}get value(){return this._timingFunction(this._progress)}_update(){if(!(this._startTime<0)){this._progress=Math.min((performance.now()-this._startTime)/this._duration,1);try{this._action(this)}catch(e){throw this.cancel(),e}if(this._progress<1)requestAnimationFrame(()=>this._update());else{this._startTime=-1,this._progress=0;for(let e of this._finishedCallbacks)e()}}}}class HIRectInterpolation{constructor(e,t){this._x=e.x,this._y=e.y,this._w=e.width,this._h=e.height,this._dx=t.x-e.x,this._dy=t.y-e.y,this._dw=t.width-e.width,this._dh=t.height-e.height}rectAt(e){return{x:this._x+this._dx*e,y:this._y+this._dy*e,width:this._w+this._dw*e,height:this._h+this._dh*e}}}let e=0,t=0;function i(){let i=e;i=1664525*i+1013904223&4294967295,e=i;let s=t;return s=1103515245*s+12345&4294967295,t=s,i<0&&(i>>>=0),s<0&&(s>>>=0),s.toString(16).padStart(8,"0")+i.toString(16).padStart(8,"0")}const s=new WeakMap;function n(e){let t=s.get(e);return void 0===t&&(t=Object.freeze(Object.create(e)),s.set(e,t)),t}function r(e,t,i){let s=i.get;i.get=function(){let i=s.call(e);return Object.defineProperty(e,t,{value:i,configurable:!0}),i}}function*o(e,t){let i={node:e,next:null},s=i;do{yield i.node;for(let e of i.node[t])s=s.next={node:e,next:null};i=i.next}while(null!==i)}function*a(e,t){yield e;for(let i of e[t])yield*a(i,t)}function l(e,t,i){null!==e&&(i?e.setAttribute(t,""):e.removeAttribute(t))}function h(e,t){if(null!==e)switch(t){case-1:e.setAttribute("state","mixed");break;case 0:e.removeAttribute("state");break;case 1:e.setAttribute("state","on")}}function d(e,t){if(null!==e)switch(t){case 0:e.removeAttribute("alignment");break;case 1:e.setAttribute("alignment","left");break;case 2:e.setAttribute("alignment","right");break;case 3:e.setAttribute("alignment","center");break;case 4:e.setAttribute("alignment","justified")}}var u=function(e,t,i,s){var n,r=arguments.length,o=r<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(r<3?n(o):r>3?n(t,i,o):n(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const c=Object.create(null);class HINotificationCenter{constructor(){this._observations=new WeakMap}static get default(){return new HINotificationCenter}addObserver(e,t,i,s){null!=s||(s=c);let n=this._observations.get(s);void 0===n&&this._observations.set(s,n=new Map);let r=n.get(i);void 0===r&&n.set(i,r=new Map),r.set(e,t)}removeObserver(e,t,i){null!=i||(i=c);let s=this._observations.get(i);if(void 0===s)return;let n=s.get(t);void 0!==n&&void 0!==n.get(e)&&(n.delete(e),i!==c&&(0===n.size&&s.delete(t),0===s.size&&this._observations.delete(i)))}post(e,t,i){let s=Object.freeze({name:e,sender:t,userInfo:i}),n=(null!=t?t:c)===c?[c]:[t,c];for(let t of n){let i=this._observations.get(t);if(void 0===i)continue;let n=i.get(e);if(void 0!==n)for(let[e,t]of n)e[t](s)}}}u([r],HINotificationCenter,"default",null);const _=new Map,m=new Set,p=new WeakMap;let g=null;class HIAppearance{constructor(e,t,i=null){this._name=e,this._dom=document.createElement("style"),this._base=t,this._accentColor=i,this._accentedExtensions=null,this._inUseCount=0}static get system(){return v()}static set system(e){!function(e){if(null===e){if(f)return;f=!0,w=null,v()}else{if(w===e)return;f=!1,w=e,e.applyForDOM(document.body)}HINotificationCenter.default.post(HIAppearance.didChangeSystemAppearanceNotification,null)}(e)}static get current(){return null!=g?g:v()}asCurrent(e){let t=g;g=this,e(),g=t}withAccentColor(e){if(e.isDynamicProvided)throw new Error("Dynamic provided accent color will cause infinite recursion.");if(e===this._accentColor)return this;if(null!==this._accentedExtensions){let t=this._accentedExtensions.get(e);if(void 0!==t)return t}let t=i(),s=`${this._name}-${t}`;return new HIAppearance(s,this,e)}get isDark(){let e=this;for(;null!==e;){if(e===HIAppearance.darkAqua)return!0;e=e._base}return!1}bestMatchFrom(e){let t=null,i=1/0;for(let s of e){if(s===this)return s;let e=0,n=this;do{if(n===s){e<i&&(t=s,i=e);break}e+=1,n=n._base}while(null!==n)}return t}applyForDOM(e){let t=p.get(e);t!==this&&(void 0!==t&&HIAppearance.disposeForDOM(e),0===this._inUseCount&&(this._updateCSSVariables(),m.add(this),document.head.appendChild(this._dom)),this._inUseCount+=1,p.set(e,this),e.setAttribute("hi-appearance",this._name))}static disposeForDOM(e){let t=p.get(e);void 0!==t&&(t._inUseCount-=1,p.delete(e),e.removeAttribute("hi-appearance"),0===t._inUseCount&&(m.delete(t),document.head.removeChild(t._dom)))}_updateCSSVariables(){let e=g;g=this;let t=`[hi-appearance="${this._name}"] {\n`;for(let[e,i]of _)t+=`\t${e}: ${i(this)};\n`;t+="}",this._dom.textContent=t,g=e}static addCSSVariableProvider(e,t){if(_.has(e))throw new Error(`The CSS variable provider "${e}" has already been registered.`);_.set(e,t);for(let e of m)e._updateCSSVariables()}static suggestCSSVariableName(e){let t;if(e)do{t=e}while(_.has(t));else do{t=`--${i()}`}while(_.has(t));return t}}HIAppearance.aqua=new HIAppearance("aqua",null),HIAppearance.darkAqua=new HIAppearance("aqua-dark",null),HIAppearance.accessibilityHighContrastAqua=new HIAppearance("high-contrast",HIAppearance.aqua),HIAppearance.accessibilityHighContrastDarkAqua=new HIAppearance("high-contrast-dark",HIAppearance.darkAqua),HIAppearance.didChangeSystemAppearanceNotification="HIDidChangeSystemAppearanceNotification";let w=null,f=!0;function v(){if(null===w){let e=window.matchMedia("(prefers-color-scheme: dark)").matches,t=window.matchMedia("(forced-colors: active)").matches;w=e?t?HIAppearance.accessibilityHighContrastDarkAqua:HIAppearance.darkAqua:t?HIAppearance.accessibilityHighContrastAqua:HIAppearance.aqua,w.applyForDOM(document.body)}return w}window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{f&&(w=null,v(),HINotificationCenter.default.post(HIAppearance.didChangeSystemAppearanceNotification,null))}),window.matchMedia("(forced-colors: active)").addEventListener("change",()=>{f&&(w=null,v(),HINotificationCenter.default.post(HIAppearance.didChangeSystemAppearanceNotification,null))});const y=[[2,"mouseDown","mouseDragged","mouseUp","rightMouseDown","rightMouseDragged","rightMouseUp","otherMouseDown","otherMouseDragged","otherMouseUp"],[4,"scrollWheel"],[8,"keyDown","keyUp"]],b=Symbol("classMetadata"),I=navigator.platform.startsWith("Mac")||navigator.platform.startsWith("iP");class HIEvent{constructor(e,t){this.type=e,this.native=t,this._responseless=!1,this._allowsNativeDefault=!1}setAllowsNativeDefault(){this._allowsNativeDefault=!0}get allowsNativeDefault(){return this._allowsNativeDefault}setResponseless(){this._responseless=!0,this._allowsNativeDefault=!0}get isResponseless(){return this._responseless}static get current(){return this._stack.length?this._stack[this._stack.length-1]:null}static push(e){e.native.stopPropagation(),this._stack.push(e)}static pop(e){let t=this._stack.pop();if(void 0===t)throw new Error("No current event.");if(void 0!==e&&t!==e)throw new Error("The current event is not the expected one.");return t.isResponseless||t._allowsNativeDefault||t.native.preventDefault(),t}get isShiftKeyDown(){return!0===this.native.shiftKey}get isOptionKeyDown(){return!0===this.native.altKey}get isMetaKeyDown(){return I?!0===this.native.metaKey:!0===this.native.ctrlKey}isMouseInDOM(e){if(!(this.native instanceof MouseEvent))return!1;let{clientX:t,clientY:i}=this.native,{left:s,top:n,right:r,bottom:o}=e.getBoundingClientRect();return t>=s&&t<r&&i>=n&&i<o}}HIEvent._stack=[];class HIResponder{get classMetadata(){let e=this.constructor.prototype,t=Object.getOwnPropertyDescriptor(e,b);if(void 0!==t)return t.value;{let t=this.constructor.makeClassMetadata();return Object.defineProperty(e,b,{value:t}),t}}static makeClassMetadata(){let e=this.prototype,t=0;for(let[i,...s]of y)for(let n of s)if(e[n]!==HIResponder.prototype[n]){t|=i;break}return{eventOverrides:t}}get nextResponder(){return null}get acceptsFirstResponder(){return!1}becomeFirstResponder(){return!0}resignFirstResponder(){return!0}_passUpEvent(e,t){let i=HIResponder.prototype[t],s=this.nextResponder;for(;null!==s;){let n=s[t];if(n!==i)return n.call(s,e);s=s.nextResponder}e.setResponseless()}mouseDown(e){this._passUpEvent(e,"mouseDown")}mouseDragged(e){this._passUpEvent(e,"mouseDragged")}mouseUp(e){this._passUpEvent(e,"mouseUp")}rightMouseDown(e){this._passUpEvent(e,"rightMouseDown")}rightMouseDragged(e){this._passUpEvent(e,"rightMouseDragged")}rightMouseUp(e){this._passUpEvent(e,"rightMouseUp")}otherMouseDown(e){this._passUpEvent(e,"otherMouseDown")}otherMouseDragged(e){this._passUpEvent(e,"otherMouseDragged")}otherMouseUp(e){this._passUpEvent(e,"otherMouseUp")}mouseEntered(e){this._passUpEvent(e,"mouseEntered")}mouseExited(e){this._passUpEvent(e,"mouseExited")}mouseMoved(e){this._passUpEvent(e,"mouseMoved")}scrollWheel(e){this._passUpEvent(e,"scrollWheel")}keyDown(e){this._passUpEvent(e,"keyDown")}keyUp(e){this._passUpEvent(e,"keyUp")}}class HIView extends HIResponder{constructor(){super(),this._uniqueID=null,this._dom=new.target.makeDOM(),this._domRegisteredEvents=0,this._window=null,this._windowContent=!1,this._superview=null,this._subviews=[],this._delegate=null,this._trackingAreas=[],this._needsLayoutState=0,this._needsDisplayState=0,this._needsCalculateSubviewKeyOrder=!1,this._indexOfFirstKeySubview=-1,this._indexOfLastKeySubview=-1,this._indexOfNextKeySibling=-1,this._indexOfPrevKeySibling=-1,this._appearance=null,this._effectiveAppearance=HIAppearance.system}static makeClassMetadata(){let e=this.prototype,t=0;for(let[i,...s]of y){for(let n of s)if(e[n]!==HIView.prototype[n]){t|=i;break}if(2===i){e.menuForEvent!==HIView.prototype.menuForEvent&&(t|=i)}}return{eventOverrides:t}}get uniqueID(){return null===this._uniqueID&&(this._uniqueID=this.constructor.name.toLowerCase()+"-"+i()),this._uniqueID}get tag(){return-1}static makeDOM(){return document.createElement("div")}get dom(){return this._dom}viewWithDOM(e){let t=[],i=e;for(;null!==i&&i!==this._dom;)t.push(i),i=i.parentNode;if(null===i)return null;let s=this;e:for(;t.length;){i=t.pop();for(let e of s._subviews)if(e._dom===i){s=e;continue e}}return s}get window(){return this._window}get superview(){return this._superview}get subviews(){return n(this._subviews)}isDescendantOf(e){let t=e._superview,i=this;do{if(i===t)return!1;if(i===e)return!0;i=i._superview}while(null!==i);return!1}ancestorSharedWith(e){if(this===e)return this;let t=this,i=0;for(;null!==t._superview;)t=t._superview,i+=1;let s=e,n=0;for(;null!==s._superview;)s=s._superview,n+=1;if(t!==s)return null;let r=this,o=e;for(;i>n;)r=r._superview,i-=1;for(;n>i;)o=o._superview,n-=1;for(;r!==o;)r=r._superview,o=o._superview;return r}addSubview(e){e._superview!==this&&this.insertSubview(e,this._subviews.length)}insertSubview(e,t){let i=this._subviews.length;if(t<0||t>i)throw new RangeError(`Index ${t} out of bounds 0...${i}`);let s=e._superview;if(s===this){let s=this._subviews.indexOf(e);if(s===t)return;t===i&&(t-=1),this._subviews.splice(s,1),this.insertDOMOfProposedSubview(e,t),this._subviews.splice(t,0,e)}else{if(null==s||s.willRemoveSubview(e),e.willMoveToSuperview(this),null!==s){let t=s._subviews.indexOf(e);s._subviews.splice(t,1),s.setNeedsLayout(),s._setNeedsCalculateSubviewKeyOrder()}e._superview=this,this.insertDOMOfProposedSubview(e,t),this._subviews.splice(t,0,e),e.didMoveToSuperview(),this.didAddSubview(e),e._setWindow(this._window),e._didChangeInheritedAppearance(this._effectiveAppearance)}e.setNeedsLayout(),this.setNeedsLayout(),this._setNeedsCalculateSubviewKeyOrder()}removeFromSuperview(){let e=this._superview;if(null===e)return;e.willRemoveSubview(this),this.willMoveToSuperview(null);let t=e._subviews.indexOf(this);e._subviews.splice(t,1),this._superview=null,this._dom.remove(),this.didMoveToSuperview(),this._setWindow(null),e.setNeedsLayout(),e._setNeedsCalculateSubviewKeyOrder()}replaceSubview(e,t){if(e._superview!==this)throw new Error("The view to be replaced is not a subview of the view.");if(e===t)return;this.willRemoveSubview(e),e.willMoveToSuperview(null);let i=this._subviews.indexOf(e),s=t._superview;if(s===this){let s=this._subviews.indexOf(t);this._subviews.splice(s,1),i>s&&(i-=1),this._subviews.splice(i,1),e._superview=null,e._dom.remove(),this.insertDOMOfProposedSubview(t,i),this._subviews.splice(i,0,t)}else{if(null==s||s.willRemoveSubview(t),t.willMoveToSuperview(this),null!==s){let e=s._subviews.indexOf(t);s._subviews.splice(e,1),s.setNeedsLayout(),s._setNeedsCalculateSubviewKeyOrder()}this._subviews.splice(i,1),e._superview=null,e._dom.remove(),t._superview=this,this.insertDOMOfProposedSubview(t,i),this._subviews.splice(i,0,t),t.didMoveToSuperview(),this.didAddSubview(t),t._setWindow(this._window),t._didChangeInheritedAppearance(this._effectiveAppearance)}e.didMoveToSuperview(),e._setWindow(null),t.setNeedsLayout(),this.setNeedsLayout(),this._setNeedsCalculateSubviewKeyOrder()}insertDOMOfProposedSubview(e,t){t===this._subviews.length?this._dom.appendChild(e._dom):this._dom.insertBefore(e._dom,this._subviews[t]._dom)}_setDelegate(e){this._delegate=e}_setWindowContent(e){this._windowContent=e}_setWindow(e){let t=this._window;if(t===e)return;let i=!1,s=!1,n=!1,r=!1;switch((null===t?0:t._state)<<2|(null===e?0:e._state)){case 0:case 5:case 7:case 10:case 13:break;case 1:case 3:i=!0;break;case 2:i=!0,s=!0;break;case 4:case 12:r=!0;break;case 6:case 14:s=!0;break;case 8:n=!0,r=!0;break;case 9:case 11:n=!0}let a=null===t?null:t.firstResponder;for(let s of o(this,"_subviews"))s.willMoveToWindow(e),i?s._willAppear():n&&s._willDisappear(),s._window=e,s===a&&(t.makeFirstResponder(null),a=null);for(let e of o(this,"_subviews"))e.didMoveToWindow(),s?e._didAppear():r&&e._didDisappear(),e._updateDOMEventRegistration();null!==t&&(t._setViewTreeNeedsLayout(),t._setViewTreeNeedsDisplay()),null!==e&&(e._setViewTreeNeedsLayout(),e._setViewTreeNeedsDisplay())}_windowWillAppear(){for(let e of o(this,"_subviews"))e._willAppear()}_windowDidAppear(){for(let e of o(this,"_subviews"))e._didAppear()}_windowWillDisappear(){for(let e of o(this,"_subviews"))e._willDisappear()}_windowDidDisappear(){for(let e of o(this,"_subviews"))e._didDisappear()}willMoveToWindow(e){}didMoveToWindow(){}willMoveToSuperview(e){}didMoveToSuperview(){}willRemoveSubview(e){}didAddSubview(e){}get nextResponder(){return null!==this._delegate?this._delegate:this._nextResponderIgnoringDelegate}get _nextResponderIgnoringDelegate(){return null!==this._window&&this._windowContent?this._window:this._superview}get trackingAreas(){return n(this._trackingAreas)}addTrackingArea(e){if(null!==e.owner)throw new Error("The tracking area is already owned by another view.");e._setOwner(this),this._trackingAreas.push(e)}removeTrackingArea(e){e.owner===this&&(e._setOwner(null),this._trackingAreas.splice(this._trackingAreas.indexOf(e),1))}menuForEvent(e){return null}rightMouseDown(e){let t=this.menuForEvent(e);null!==t?t.popUpContextMenu(e,this):super.rightMouseDown(e)}_updateDOMEventRegistration(){let e=0,t=this,i=3;for(;null!==t&&t!==this._superview&&i>0;)e|=t.classMetadata.eventOverrides,t=t.nextResponder,i-=1;t!==this._superview&&(e=14);let s=this._domRegisteredEvents&~e,n=e&~this._domRegisteredEvents;this._domRegisteredEvents=e,2&s&&this._dom.removeEventListener("mousedown",this),4&s&&this._dom.removeEventListener("wheel",this),8&s&&(this._dom.removeEventListener("keydown",this),this._dom.removeEventListener("keyup",this)),2&n&&this._dom.addEventListener("mousedown",this),4&n&&this._dom.addEventListener("wheel",this),8&n&&(this._dom.addEventListener("keydown",this),this._dom.addEventListener("keyup",this))}handleEvent(e){if(null===this._window)return;let t,i;switch(e.type){case"mousedown":return void this._window._viewDOMMouseDown(this,e);case"wheel":t=new HIEvent(4096,e),i="scrollWheel";break;case"keydown":t=new HIEvent(8192,e),i="keyDown";break;case"keyup":t=new HIEvent(16384,e),i="keyUp";break;default:return}HIEvent.push(t),this[i](t),HIEvent.pop(t)}acceptsFirstMouse(e){return!1}shouldDelayWindowOrdering(e){return!1}get needsPanelToBecomeKey(){return this.acceptsFirstResponder}get canBecomeKeyView(){return null!==this._window&&this.acceptsFirstResponder}_setNeedsCalculateSubviewKeyOrder(){this._needsCalculateSubviewKeyOrder=!0,null!==this._window&&this._window.isVisible&&this._calculateSubviewKeyOrderIfNeeded()}_calculateSubviewKeyOrderIfNeeded(){if(!this._needsCalculateSubviewKeyOrder)return;if(this._needsCalculateSubviewKeyOrder=!1,0===this._subviews.length)return this._indexOfFirstKeySubview=-1,void(this._indexOfLastKeySubview=-1);let e=this._subviews.map((e,t)=>({view:e,index:t})).sort((e,t)=>{switch(e.view._dom.compareDocumentPosition(t.view._dom)){case Node.DOCUMENT_POSITION_FOLLOWING:return-1;case Node.DOCUMENT_POSITION_PRECEDING:return 1;default:throw new Error("The DOM objects of two subviews are not well-orderd.")}});this._indexOfFirstKeySubview=e[0].index,this._indexOfLastKeySubview=e[e.length-1].index,e[0].view._indexOfPrevKeySibling=-1;for(let t=1;t<e.length;++t)e[t-1].view._indexOfNextKeySibling=e[t].index,e[t].view._indexOfPrevKeySibling=e[t-1].index;e[e.length-1].view._indexOfNextKeySibling=-1}_nextKeyViewUntil(e){let t=this;for(;;){if(t._subviews.length)t._calculateSubviewKeyOrderIfNeeded(),t=t._subviews[t._indexOfFirstKeySubview];else for(;;){let e=t._superview;if(null===e)break;if(e._calculateSubviewKeyOrderIfNeeded(),-1!==t._indexOfNextKeySibling){t=e._subviews[t._indexOfNextKeySibling];break}t=e}if(t===this)return null;if(e(t))return t}}_prevKeyViewUntil(e){let t=this;for(;;){let i=t._superview;if(null===i)for(;t._subviews.length;)t._calculateSubviewKeyOrderIfNeeded(),t=t._subviews[t._indexOfLastKeySubview];else if(i._calculateSubviewKeyOrderIfNeeded(),-1===t._indexOfPrevKeySibling)t=i;else for(t=i._subviews[t._indexOfPrevKeySibling];t._subviews.length;)t._calculateSubviewKeyOrderIfNeeded(),t=t._subviews[t._indexOfLastKeySubview];if(t===this)return null;if(e(t))return t}}get nextKeyView(){return this._nextKeyViewUntil(()=>!0)}get previousKeyView(){return this._prevKeyViewUntil(()=>!0)}get nextValidKeyView(){return this._nextKeyViewUntil(e=>e.canBecomeKeyView)}get previousValidKeyView(){return this._prevKeyViewUntil(e=>e.canBecomeKeyView)}get keyDOM(){return this._dom}layout(){}get needsLayout(){return 1===this._needsLayoutState}setNeedsLayout(){this.layout!==HIView.prototype.layout&&0===this._needsLayoutState&&(this._needsLayoutState=1,null!==this._window&&this._window._setViewTreeNeedsLayout(),this.setNeedsDisplay())}layoutSubtreeIfNeeded(){if(null===this._window)return;if(0===this._window._state)return;let e=this._window.firstResponder,t=!1;for(let i of a(this,"_subviews"))i===e&&(t=!0),1===i._needsLayoutState&&(i._needsLayoutState=-1,i.layout(),i._needsLayoutState=0);t&&this._window._updateFocusRing(!1)}get preferredSize(){return{width:-1,height:-1}}static get noPreferredMetric(){return-1}_willAppear(){var e,t;null===(e=this.appearance)||void 0===e||e.applyForDOM(this.appearanceDOM),this.willUnhide(),null===(t=this._delegate)||void 0===t||t.viewWillAppear()}_didAppear(){var e;this.didUnhide(),null===(e=this._delegate)||void 0===e||e.viewDidAppear()}_willDisappear(){var e;this.willHide(),null===(e=this._delegate)||void 0===e||e.viewWillDisappear()}_didDisappear(){var e;this.didHide(),null===(e=this._delegate)||void 0===e||e.viewDidDisappear(),HIAppearance.disposeForDOM(this.appearanceDOM)}willUnhide(){}didUnhide(){}willHide(){}didHide(){}get isHidden(){return null===this._window||0===this._window._state}display(){}get needsDisplay(){return 1===this._needsDisplayState}setNeedsDisplay(){this.display!==HIView.prototype.display&&0===this._needsDisplayState&&(this._needsDisplayState=1,null!==this._window&&this._window._setViewTreeNeedsDisplay())}displayIfNeeded(){if(null!==this._window&&0!==this._window._state)for(let e of a(this,"_subviews"))1===e._needsDisplayState&&(e._needsDisplayState=-1,e._effectiveAppearance.asCurrent(()=>e.display()),e._needsDisplayState=0)}get allowsFocusRing(){return!1}noteFocusRingChanged(){var e;this===(null===(e=this._window)||void 0===e?void 0:e.firstResponder)&&this._window._updateFocusRing(!1)}get appearanceDOM(){return this._dom}get appearance(){return this._appearance}set appearance(e){if(this._appearance===e)return;this._appearance=e;let t=e;if(null===t&&(t=null===this._superview?HIAppearance.system:this._superview._effectiveAppearance),this._effectiveAppearance!==t){this._effectiveAppearance=t,this.didChangeEffectiveAppearance(),this.setNeedsDisplay();for(let e of this._subviews)e._didChangeInheritedAppearance(t)}null!==this._window&&0!==this._window._state&&(null!==e?e.applyForDOM(this.appearanceDOM):HIAppearance.disposeForDOM(this.appearanceDOM))}get effectiveAppearance(){return this._effectiveAppearance}_didChangeInheritedAppearance(e){if(null===this._appearance&&this._effectiveAppearance!==e){this._effectiveAppearance=e,this.didChangeEffectiveAppearance(),this.setNeedsDisplay();for(let t of this._subviews)t._didChangeInheritedAppearance(e)}}didChangeEffectiveAppearance(){}}class HIColor{constructor(e,t,i){this._name=i,this._type=e,this._provider=t,this._resolved=null,this._cssVarName=null}static fromComponents(e,t,i,s=1){return e=M(e),t=M(t),i=M(i),s=M(s),new HIColor(0,[e,t,i,s],null)}static fromGrayscale(e,t=1){return e<=0?HIColor.black:e>=1?HIColor.white:new HIColor(0,[e,e,e,t],null)}static dynamicProvided(e){return new HIColor(2,e,null)}get isResolved(){return 0===this._type}get isDynamicProvided(){return this._type>=2}_withName(e){return new HIColor(this._type,this._provider,e)}_mappingRGBA(e){switch(this._type){case 0:return new HIColor(0,e(this._provider),null);case 1:return new HIColor(1,this._provider.map(e),null);case 2:return new HIColor(2,t=>this.resolved(t)._mappingRGBA(e),null)}}_mappingRGBAPair(e,t){if(0===this._type&&0===e._type){let i=this._provider,s=e._provider;return new HIColor(0,t(i,s),null)}if(0===this._type&&1===e._type){let i=this._provider,s=e._provider;return new HIColor(1,s.map(e=>t(i,e)),null)}if(1===this._type&&0===e._type){let i=this._provider,s=e._provider;return new HIColor(1,i.map(e=>t(e,s)),null)}if(1===this._type&&1===e._type){let i=this._provider,s=e._provider;return new HIColor(1,i.map((e,i)=>t(e,s[i])),null)}return new HIColor(2,i=>this.resolved(i)._mappingRGBAPair(e.resolved(i),t),null)}withAlpha(e){return e>=1?this:e<=0?HIColor.clear:this._mappingRGBA(([t,i,s,n])=>[t,i,s,n*e])}blending(e,t,i=0){if(t<=0)return this;if(t>=1){if(0===i)return e;t=1}return this._mappingRGBAPair(e,(e,s)=>function(e,t,i,s){let[n,r,o,a]=e,[l,h,d,u]=t,[c,_,m]=D([n,r,o,1],[l,h,d,i],s),p=M(a*(1-i)+u*i);return[c,_,m,p]}(e,s,t,i))}composition(e,t=0){return this._mappingRGBAPair(e,(e,i)=>D(e,i,t))}resolved(e){if(0===this._type)return this;null===this._resolved&&(this._resolved=new WeakMap),void 0===e&&(e=HIAppearance.current);let t=this._resolved.get(e);if(void 0===t){switch(this._type){case 2:t=this._provider(e),t=t.resolved(e);break;case 1:t=new HIColor(0,this._provider[e.isDark?1:0],this._name)}this._resolved.set(e,t)}return t}get components(){return this.resolved()._provider}get brightness(){let[e,t,i]=this.components;return.299*e+.587*t+.114*i}get cssColor(){let[e,t,i,s]=this.components;return 0===s?"transparent":(e=Math.round(255*e),t=Math.round(255*t),i=Math.round(255*i),1===s?"#"+e.toString(16).padStart(2,"0")+t.toString(16).padStart(2,"0")+i.toString(16).padStart(2,"0"):`rgba(${e}, ${t}, ${i}, ${s})`)}cssUsage(){if(0===this._type&&null===this._name)return this.cssColor;if(null===this._cssVarName){let e=this._name?`--hi-${this._name}-color`:HIAppearance.suggestCSSVariableName();this._cssVarName=e,HIAppearance.addCSSVariableProvider(e,e=>this.resolved(e).cssColor)}return`var(${this._cssVarName})`}}function M(e){return e<0?0:e>1?1:e}function D(e,t,i){let[s,n,r,o]=e,[a,l,h,d]=t,u=M(o*(1-d)+d);if(0===u)return[0,0,0,0];let c=C(s,a,i),_=C(n,l,i),m=C(r,h,i),p=d*(1-o),g=(1-d)*o,w=d*o;return c=M(g*s+p*a+w*c),_=M(g*n+p*l+w*_),m=M(g*r+p*h+w*m),[c,_,m,u]}function C(e,t,i){switch(i){case 0:return t;case 1:return Math.min(e,t);case 2:return Math.max(e,t);case 3:return e*t;case 4:return e+t-e*t;case 5:return 1===e?1:0===t?0:1-(1-e)/t;case 6:return 0===e?0:1===t?1:e/(1-t);case 7:return e+t-1;case 8:return e+t;case 9:return e<.5?2*e*t:1-2*(1-e)*(1-t);case 10:return t<.5?2*e*t:1-2*(1-e)*(1-t);case 11:return(1-2*t)*e*e+2*t*e}}HIColor.clear=new HIColor(0,[0,0,0,0],null),HIColor.black=new HIColor(0,[0,0,0,1],null),HIColor.white=new HIColor(0,[1,1,1,1],null),HIColor.systemRed=new HIColor(1,[[1,.231,.188,1],[1,.271,.227,1]],"system-red"),HIColor.systemOrange=new HIColor(1,[[1,.584,0,1],[1,.624,.039,1]],"system-orange"),HIColor.systemYellow=new HIColor(1,[[1,.8,0,1],[1,.839,.039,1]],"system-yellow"),HIColor.systemGreen=new HIColor(1,[[.204,.78,.349,1],[.196,.843,.294,1]],"system-green"),HIColor.systemMint=new HIColor(1,[[0,.78,.745,1],[.388,.902,.886,1]],"system-mint"),HIColor.systemTeal=new HIColor(1,[[.188,.69,.78,1],[.251,.784,.878,1]],"system-teal"),HIColor.systemCyan=new HIColor(1,[[.196,.678,.902,1],[.392,.824,1,1]],"system-cyan"),HIColor.systemBlue=new HIColor(1,[[0,.478,1,1],[.039,.518,1,1]],"system-blue"),HIColor.systemIndigo=new HIColor(1,[[.345,.337,.839,1],[.369,.361,.902,1]],"system-indigo"),HIColor.systemPurple=new HIColor(1,[[.686,.322,.871,1],[.749,.353,.949,1]],"system-purple"),HIColor.systemPink=new HIColor(1,[[1,.314,.4,1],[1,.216,.373,1]],"system-pink"),HIColor.systemBrown=new HIColor(1,[[.635,.518,.369,1],[.675,.557,.408,1]],"system-brown"),HIColor.systemGray=new HIColor(0,[.557,.557,.576,1],"system-gray"),HIColor.controlAccent=new HIColor(2,e=>{let t=e._accentColor;return null===t?HIColor.systemBlue:t},"control-accent"),HIColor.label=new HIColor(1,[[0,0,0,.85],[1,1,1,.85]],"label"),HIColor.secondaryLabel=new HIColor(1,[[0,0,0,.55],[1,1,1,.55]],"secondary-label"),HIColor.tertiaryLabel=new HIColor(1,[[0,0,0,.25],[1,1,1,.25]],"tertiary-label"),HIColor.quaternaryLabel=new HIColor(1,[[0,0,0,.1],[1,1,1,.1]],"quaternary-label"),HIColor.text=new HIColor(1,[[0,0,0,1],[1,1,1,1]],"text"),HIColor.textBackground=new HIColor(1,[[1,1,1,1],[0,0,0,1]],"text-background"),HIColor.placeholderText=HIColor.tertiaryLabel._withName("placeholder-text"),HIColor.border=new HIColor(1,[[0,0,0,.15],[1,1,1,.15]],"border"),HIColor.windowFrameText=new HIColor(1,[[0,0,0,.7],[1,1,1,.7]],"window-frame-text"),HIColor.windowBackground=new HIColor(1,[[.929,.929,.929,1],[.156,.156,.156,1]],"window-background"),HIColor.controlText=HIColor.label._withName("control-text"),HIColor.disabledControlText=HIColor.tertiaryLabel._withName("disabled-control-text"),HIColor.controlBackground=new HIColor(1,[[1,1,1,1],[.118,.118,.118,1]],"control-background"),HIColor.selectedControlText=new HIColor(2,e=>{let t=e.isDark,i=HIColor.controlAccent.resolved(e).brightness>.6;return HIColor.fromGrayscale(i?0:1,t||i?.85:1)},"selected-control-text"),HIColor.selectedContentBackground=new HIColor(2,e=>{let t=e.isDark;return HIColor.controlAccent.resolved(e).blending(HIColor.black,t?.18:.11,7)},"selected-control-background");for(let pe in HIColor){HIColor[pe].cssUsage()}const x=Symbol("observer"),k=Symbol("storageKeys"),O=new Map;function H(e,t){e[x]=t}function A(e,t,i){e[O.get(t)]=i}const S=class HIObservable{static get observerAction(){throw new Error("Subclasses of `HIObservable` must implement the `observerAction` getter.")}static get observedKeys(){throw new Error("Subclasses of `HIObservable` must implement the `observedKeys` getter.")}constructor(e){var t;let i=new.target,s=Reflect.get(i,k);if(void 0===s){s=new Map,Reflect.set(i,k,s);let e=i.observerAction,t=i.observedKeys,n=i.prototype;for(let i of t){let t=O.get(i);void 0===t&&(t=Symbol(i),O.set(i,t)),s.set(i,t),Reflect.defineProperty(n,i,{enumerable:!0,get(){return Reflect.get(this,t)},set(s){let n=Reflect.get(this,t);Reflect.set(this,t,s);let r=this[x];null!==r&&r[e](this,i,s,n)}})}}for(let i in e){let n=null!==(t=s.get(i))&&void 0!==t?t:i;Reflect.set(this,n,e[i])}this[x]=null}},V={minX:0,minY:0,maxX:0,maxY:0};class _HIContentInsets extends S{constructor(){super(V)}static get observerAction(){return"contentInsetsDidChange"}static get observedKeys(){return["minX","minY","maxX","maxY"]}}class _HICheckedSize{constructor(e,t){this._width=R(e),this._height=R(t)}get width(){return this._width}set width(e){this._width=R(e)}get height(){return this._height}set height(e){this._height=R(e)}}function R(e){if(!Number.isFinite(e))return 0;let t=window.devicePixelRatio;return Math.round(e*t)/t}function L(e){let{width:t,height:i}=e,s=window.devicePixelRatio;return t=Number.isFinite(t)?Math.ceil(t*s)/s:0,i=Number.isFinite(i)?Math.ceil(i*s)/s:0,{width:t,height:i}}function T(e){let{x:t,y:i,width:s,height:n}=e,r=window.devicePixelRatio,o=t+s,a=i+n;return t=Number.isFinite(t)?Math.floor(t*r)/r:0,i=Number.isFinite(i)?Math.floor(i*r)/r:0,o=Number.isFinite(o)?Math.ceil(o*r)/r:0,a=Number.isFinite(a)?Math.ceil(a*r)/r:0,{x:t,y:i,width:o-t,height:a-i}}let E=null;function N(e,t){if(null===E){let e=document.createElement("div");e.style.position="absolute",e.style.visibility="hidden",e.style.overflow="hidden",e.style.width="1px",e.style.height="1px",document.body.appendChild(e),E=document.createElement("div"),E.style.width="10000px",E.style.height="10000px",E.style.position="relative",e.append(E)}let i=e.style.position,s=e.parentNode,n=e.nextSibling;E.appendChild(e),e.style.position="absolute";let r=t(L(e.getBoundingClientRect()));return e.style.position=i,E.removeChild(e),null!==s&&s.insertBefore(e,n),r}class HIBox extends HIView{constructor(){super(),this._titleDOM=null,this._contentDOM=document.createElement("div"),this._contentDOM.classList.add("hi-box-content"),this.dom.appendChild(this._contentDOM),this._backgroundColor=HIColor.clear,this._contentSize=null,this._contentInsets=new _HIContentInsets,H(this._contentInsets,this),this._subviewFrames=new WeakMap}static makeDOM(){let e=document.createElement("div");return e.classList.add("hi-box"),e}get title(){var e;return(null===(e=this._titleDOM)||void 0===e?void 0:e.textContent)||""}set title(e){e?(null===this._titleDOM&&(this._titleDOM=document.createElement("span"),this._titleDOM.classList.add("hi-box-title")),null===this._titleDOM.parentElement&&this._contentDOM.before(this._titleDOM),this._titleDOM.textContent=e):null!==this._titleDOM&&this._titleDOM.remove()}get backgroundColor(){return this._backgroundColor}set backgroundColor(e){e!==this._backgroundColor&&(this._backgroundColor=e,this._contentDOM.style.backgroundColor=e.cssUsage())}willRemoveSubview(e){let t=this._subviewFrames.get(e);this._subviewFrames.delete(e),t.containerDOM.remove()}insertDOMOfProposedSubview(e,t){let i=this._subviewFrames.get(e);void 0===i&&(i=new _HIViewFrame(e),this._subviewFrames.set(e,i)),null!==this._contentSize&&i.setActivitySize(this._contentSize);let s=i.containerDOM;if(t===this.subviews.length)this._contentDOM.appendChild(s);else{let e=this.subviews[t],i=this._subviewFrames.get(e).containerDOM;this._contentDOM.insertBefore(s,i)}}addSubview(e){return super.addSubview(e),this._subviewFrames.get(e)}frameFor(e){let t=this._subviewFrames.get(e);if(void 0===t)throw new Error("The view is not a subview of the box.");return t}setFrameFor(e,t,i){let s=this._subviewFrames.get(e);if(void 0===s)throw new Error("The view is not a subview of the box.");s.setXAndWidth(t.x,t.width),s.setYAndHeight(t.y,t.height),s.autoresizingMask=i}layout(){let{width:e,height:t}=this.dom.getBoundingClientRect();e-=this._contentInsets.minX+this._contentInsets.maxX,t-=this._contentInsets.minY+this._contentInsets.maxY,this.setContentSize({width:e,height:t})}setContentSize(e){if(null===this._contentSize){this._contentSize={width:e.width,height:e.height};for(let e of this.subviews){this._subviewFrames.get(e).setActivitySize(this._contentSize)}}else{let{width:t,height:i}=this._contentSize,{width:s,height:n}=e,r=t!==s,o=i!==n;if(!r&&!o)return;this._contentSize.width=s,this._contentSize.height=n;for(let e of this.subviews){let s=this._subviewFrames.get(e);r&&s.activityWidthChangedFrom(t),o&&s.activityHeightChangedFrom(i)}}}get contentInsets(){return this._contentInsets}set contentInsets(e){if(e===this._contentInsets)return;let{minX:t,minY:i,maxX:s,maxY:n}=e;t=Math.max(0,R(t)),i=Math.max(0,R(i)),s=Math.max(0,R(s)),n=Math.max(0,R(n)),A(this._contentInsets,"minX",t),A(this._contentInsets,"minY",i),A(this._contentInsets,"maxX",s),A(this._contentInsets,"maxY",n),this._contentDOM.style.margin=`${i}px ${s}px ${n}px ${t}px`,this.setNeedsLayout()}contentInsetsDidChange(e,t,i){if(e!==this._contentInsets)return;let s=Math.max(0,R(i));switch(s!==i&&A(this._contentInsets,t,s),t){case"minX":this._contentDOM.style.marginLeft=s+"px";break;case"minY":this._contentDOM.style.marginTop=s+"px";break;case"maxX":this._contentDOM.style.marginRight=s+"px";break;case"maxY":this._contentDOM.style.marginBottom=s+"px"}this.setNeedsLayout()}get contentBoundingRect(){let e=1/0,t=1/0,i=-1/0,s=-1/0;for(let n of this.subviews){let r=this._subviewFrames.get(n),{x:o,y:a,width:l,height:h}=r;e=Math.min(e,o),t=Math.min(t,a),i=Math.max(i,o+l),s=Math.max(s,a+h)}return e===1/0&&(e=0,i=0),t===1/0&&(t=0,s=0),{x:e,y:t,width:i-e,height:s-t}}get preferredSize(){let{x:e,y:t,width:i,height:s}=this.contentBoundingRect,{minX:n,minY:r,maxX:o,maxY:a}=this._contentInsets;return{width:e+i+n+o,height:t+s+r+a}}}class _HIViewFrame{constructor(e){let{width:t,height:i}=e.preferredSize,s=t===HIView.noPreferredMetric,n=i===HIView.noPreferredMetric;(s||n)&&N(e.dom,e=>{s&&(t=e.width),n&&(i=e.height)}),t=R(t),i=R(i),this._xArg1=0,this._xArg2=t,this._yArg1=0,this._yArg2=i,this._autoresizingMask=0,this._xArgMode=1,this._yArgMode=1,this._activitySize=null,this.containerDOM=document.createElement("div"),this.containerDOM.classList.add("hi-box-subview"),this.containerDOM.appendChild(e.dom),this.containerDOM.style.width=t+"px",this.containerDOM.style.height=i+"px",this.hostingView=e}get x(){return 3===this._xArgMode?this._activitySize.width-this._xArg1-this._xArg2:this._xArg1}set x(e){e=R(e),this.setXAndWidth(e,this.width)}get y(){return 3===this._yArgMode?this._activitySize.height-this._yArg1-this._yArg2:this._yArg1}set y(e){e=R(e),this.setYAndHeight(e,this.height)}get width(){return 2===this._xArgMode?this._activitySize.width-this._xArg1-this._xArg2:this._xArg2}set width(e){e=R(e),this.setXAndWidth(this.x,e)}get height(){return 2===this._yArgMode?this._activitySize.height-this._yArg1-this._yArg2:this._yArg2}set height(e){e=R(e),this.setYAndHeight(this.y,e)}get maxX(){return this.x+this.width}get maxY(){return this.y+this.height}get autoresizingMask(){return this._autoresizingMask}set autoresizingMask(e){if(e===this._autoresizingMask)return;if(e&=63,null===this._activitySize)return void(this._autoresizingMask=e);let{x:t,y:i,width:s,height:n}=this;this._autoresizingMask=e,this._updateArgModes(),this.setXAndWidth(t,s),this.setYAndHeight(i,n)}setActivitySize(e){if(null!==this._activitySize)throw new Error("The activity size of the view is already set.");this._activitySize=e,this._updateArgModes(),this.setXAndWidth(this._xArg1,this._xArg2),this.setYAndHeight(this._yArg1,this._yArg2)}activityWidthChangedFrom(e){if(0!==this._xArgMode)return this.hostingView.setNeedsLayout();let t=this._autoresizingMask,i=0;for(let e=1;e<=4;e<<=1)0!==(t&e)&&(i+=1);let s=(this._activitySize.width-e)/i,n=this._xArg1,r=this._xArg2;1&t&&(n+=s),2&t&&(r+=s),this.setXAndWidth(n,r)}activityHeightChangedFrom(e){if(0!==this._yArgMode)return this.hostingView.setNeedsLayout();let t=this._autoresizingMask,i=0;for(let e=8;e<=32;e<<=1)0!==(t&e)&&(i+=1);let s=(this._activitySize.height-e)/i,n=this._yArg1,r=this._yArg2;8&t&&(n+=s),16&t&&(r+=s),this.setYAndHeight(n,r)}setXAndWidth(e,t){switch(this._xArgMode){case 0:case 1:this._xArg1=e,this._xArg2=t,this.containerDOM.style.left=P(this._xArg1,""),this.containerDOM.style.width=P(this._xArg2);break;case 2:this._xArg1=e,this._xArg2=this._activitySize.width-e-t,this.containerDOM.style.left=P(this._xArg1,""),this.containerDOM.style.right=P(this._xArg2);break;case 3:this._xArg1=this._activitySize.width-e-t,this._xArg2=t,this.containerDOM.style.right=P(this._xArg1),this.containerDOM.style.width=P(this._xArg2)}this.hostingView.setNeedsLayout()}setYAndHeight(e,t){switch(this._yArgMode){case 0:case 1:this._yArg1=e,this._yArg2=t,this.containerDOM.style.top=P(this._yArg1,""),this.containerDOM.style.height=P(this._yArg2);break;case 2:this._yArg1=e,this._yArg2=this._activitySize.height-e-t,this.containerDOM.style.top=P(this._yArg1,""),this.containerDOM.style.bottom=P(this._yArg2);break;case 3:this._yArg1=this._activitySize.height-e-t,this._yArg2=t,this.containerDOM.style.bottom=P(this._yArg1),this.containerDOM.style.height=P(this._yArg2)}this.hostingView.setNeedsLayout()}_updateArgModes(){switch(this.containerDOM.removeAttribute("style"),7&this._autoresizingMask){case 1:this.containerDOM.style.left="auto",this._xArgMode=3;break;case 2:this._xArgMode=2;break;case 0:case 4:this._xArgMode=1;break;default:this._xArgMode=0}switch(56&this._autoresizingMask){case 8:this.containerDOM.style.top="auto",this._yArgMode=3;break;case 16:this._yArgMode=2;break;case 0:case 32:this._yArgMode=1;break;default:this._yArgMode=0}}}function P(e,t="0"){return e?e+"px":t}class HIImage{makeDOM(){return this._templateDOM.cloneNode(!0)}makeHTML(){return this._templateDOM.outerHTML}get description(){return this._description}constructor(e){this._description="",this._templateDOM=e}static _fromTemplateDOM(e){return new HIImage(e)}static fromPath(e,t){let i=document.createElement("i");i.classList.add("hi-image"),i.classList.toggle("tintable",t);let s=document.createElement("img");if(s.src=e,i.appendChild(s),t){let e=s.src.replace('"','\\"');i.classList.add("tintable","masked"),i.style.setProperty("--hi-mask-image",`url("${e}")`)}return new HIImage(i)}static _symbolFromSVGLines(...e){let t=document.createElement("i");return t.classList.add("hi-image","symbol","tintable"),t.innerHTML=e.join(""),new HIImage(t)}static symbolFromPath(e){let t=HIImage.fromPath(e,!0);return t._templateDOM.classList.add("symbol"),t}}HIImage.menuStateOn=HIImage._symbolFromSVGLines('<svg class="hi-em-image-entity" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor">','<path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M1 6.5L4 10l6-9"/>',"</svg>"),HIImage.menuStateMixed=HIImage._symbolFromSVGLines('<svg class="hi-em-image-entity" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor">','<path stroke-width="2" stroke-linecap="round" d="M2 6.5h9"/>',"</svg>"),HIImage.menuStateDiamond=HIImage._symbolFromSVGLines('<svg class="hi-em-image-entity" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor">','<path stroke-width="1.75" stroke-linejoin="round" d="M6.5 1.5l-4 5 4 5 4-5z"/>',"</svg>");class HIControl extends HIView{constructor(){super(...arguments),this._tag=0,this._target=null,this._action=null,this._enabled=!0,this._continuous=!1}get tag(){return this._tag}set tag(e){this._tag=e}get target(){return this._target}set target(e){this._target=e}get action(){return this._action}set action(e){this._action=e}get isEnabled(){return this._enabled}set isEnabled(e){this._enabled=e}get isContinuous(){return this._continuous}set isContinuous(e){this._continuous=e}get acceptsFirstResponder(){return this._enabled}acceptsFirstMouse(e){return this.isEnabled}get needsPanelToBecomeKey(){return!1}performClick(e){var t;this._enabled&&null!==this._action&&(null===(t=this.window)||void 0===t||t.sendAction(this._action,this._target,this))}sendAction(e,t){var i;null===(i=this.window)||void 0===i||i.sendAction(e,t,this)}get allowsFocusRing(){return!0}}class HICell{constructor(e){this.dom=e,this.controlView=null}}{let ge=HIColor.dynamicProvided(e=>e.isDark?HIColor.controlAccent.blending(HIColor.black,.08):HIColor.controlAccent.blending(HIColor.white,.43)),we=HIColor.dynamicProvided(e=>e.isDark?HIColor.controlAccent.blending(HIColor.black,.18):HIColor.controlAccent.blending(HIColor.white,0)),fe=HIColor.dynamicProvided(e=>e.isDark?HIColor.controlAccent.blending(HIColor.black,.1):HIColor.controlAccent.blending(HIColor.white,.25));function ve(e,t=!1){return t?e.blending(HIColor.white,.09,8):e.blending(HIColor.black,.09,7)}function ye(e){return`linear-gradient(${e}, ${e})`}function be(e){return e.blending(HIColor.black,.5,11)}HIAppearance.addCSSVariableProvider("--hi-rounded-bezel-background",e=>ye(e.isDark?"#fff4":"#fff")),HIAppearance.addCSSVariableProvider("--hi-rounded-bezel-highlighted-background",e=>ye(e.isDark?"#fff6":"#f0f0f0")),HIAppearance.addCSSVariableProvider("--hi-rounded-bezel-selected-background",e=>ye(e.isDark?"#fff8":"#e5e5e5")),HIAppearance.addCSSVariableProvider("--hi-rounded-bezel-key-background",e=>{let t=ge.resolved(e),i=we.resolved(e);return`linear-gradient(${t.cssColor}, ${i.cssColor})`}),HIAppearance.addCSSVariableProvider("--hi-rounded-bezel-highlighted-key-background",e=>{let t=ve(ge.resolved(e),e.isDark),i=ve(we.resolved(e),e.isDark);return`linear-gradient(${t.cssColor}, ${i.cssColor})`}),HIAppearance.addCSSVariableProvider("--hi-rounded-bezel-border-color",e=>"rgba(0, 0, 0, 0.15)"),HIAppearance.addCSSVariableProvider("--hi-rounded-bezel-border-background",e=>ye("rgba(0, 0, 0, 0.15)")),HIAppearance.addCSSVariableProvider("--hi-rounded-bezel-border-key-background",e=>{if(e.isDark)return"rgba(0, 0, 0, 0.15)";let t=be(ge.resolved(e)),i=be(we.resolved(e));return`linear-gradient(${t.cssColor}, ${i.cssColor})`}),HIAppearance.addCSSVariableProvider("--hi-rounded-bezel-border-highlighted-key-background",e=>{if(e.isDark)return"rgba(0, 0, 0, 0.15)";let t=be(ve(ge.resolved(e))),i=be(ve(we.resolved(e)));return`linear-gradient(${t.cssColor}, ${i.cssColor})`}),HIAppearance.addCSSVariableProvider("--hi-rounded-bezel-shadow",e=>e.isDark?"0 1px 1px rgba(0, 0, 0, 0.25), inset 0 1px 1px -1px rgba(255, 255, 255, 1)":"0 1px 1px rgba(0, 0, 0, 0.15)"),HIAppearance.addCSSVariableProvider("--hi-field-bezel-background-color",e=>e.isDark?"#fff2":"#fff"),HIAppearance.addCSSVariableProvider("--hi-field-bezel-highlighted-background-color",e=>e.isDark?"#fff4":"#f0f0f0"),HIAppearance.addCSSVariableProvider("--hi-field-bezel-key-background-color",e=>fe.resolved(e).cssColor),HIAppearance.addCSSVariableProvider("--hi-field-bezel-highlighted-key-background-color",e=>ve(fe.resolved(e),e.isDark).cssColor),HIAppearance.addCSSVariableProvider("--hi-field-bezel-highlighted-ring-color",e=>e.isDark?"rgba(255, 255, 255, 0.15)":"rgba(0, 0, 0, 0.15)"),HIAppearance.addCSSVariableProvider("--hi-field-bezel-shadow",e=>e.isDark?"inset 0 0 0 var(--min-pixel) rgba(255, 255, 255, 0.1), inset 0 -1px 2px -1px rgba(255, 255, 255, 0.3), 0 0 0 var(--min-pixel) rgba(0, 0, 0, 0.2)":"inset 0 0 0 var(--min-pixel) rgba(100, 100, 100, 0.5), inset 0 1px 2px -1px rgba(0, 0, 0, 0.5)"),HIAppearance.addCSSVariableProvider("--hi-field-bezel-key-shadow",e=>e.isDark?"inset 0 0 0 var(--min-pixel) rgba(255, 255, 255, 0.1), inset 0 -1px 2px -1px rgba(255, 255, 255, 0.3), 0 0 0 var(--min-pixel) rgba(0, 0, 0, 0.2)":"inset 0 0 0 var(--min-pixel) rgba(0, 0, 0, 0.1), inset 0 0 transparent")}class HIButtonCell extends HICell{constructor(){super(document.createElement("span")),this.dom.classList.add("hi-button-cell"),this._bezelDOM=document.createElement("span"),this._bezelDOM.classList.add("hi-button-bezel"),this.dom.appendChild(this._bezelDOM),this._titleDOM=null,this._imageDOM=null,this._checkRadioStateGlyphs=0,this._checkRadioTimer=0,this._checkRadio=!1,this._image=null,this._imagePosition=0,this._alignment=3,d(this.dom,this._alignment),this._state=0,this._highlighted=!1,this._style=-1,this._type=-1,this._setStyleAndType(0,0)}get keyDOM(){return this._bezelDOM}get title(){var e;return(null===(e=this._titleDOM)||void 0===e?void 0:e.textContent)||""}set title(e){if(!e)return null!==this._titleDOM&&(this._titleDOM.remove(),this._titleDOM=null),void this._moveTitleImageToPlace();null===this._titleDOM&&(this._titleDOM=document.createElement("span"),this._titleDOM.classList.add("hi-button-title"),this._moveTitleImageToPlace()),this._titleDOM.textContent=e}get image(){return this._image}set image(e){e!==this._image&&(this._image=e,this._checkRadio||this._applyImage(e))}_applyImage(e){if(null===e)return null!==this._imageDOM&&(this._imageDOM.remove(),this._titleDOM=null),void this._moveTitleImageToPlace();let t=e.makeDOM();t.classList.add("hi-button-image"),null===this._imageDOM?(this._imageDOM=t,this._moveTitleImageToPlace()):(this._imageDOM.replaceWith(t),this._imageDOM=t),this._moveTitleImageToPlace()}get imagePosition(){return this._imagePosition}set imagePosition(e){e!==this._imagePosition&&(this._imagePosition=e,null!==this._imageDOM&&this._moveTitleImageToPlace())}get imageHugsTitle(){return this.dom.classList.contains("image-hugs-title")}set imageHugsTitle(e){this.dom.classList.toggle("image-hugs-title",e)}get alignment(){return this._alignment}set alignment(e){this._alignment=e,d(this.dom,e)}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._checkRadio&&(this._addCheckRadioStateGlyph(),this._startCheckRadioAnimation()),h(this.dom,e),h(this._bezelDOM,e))}_addCheckRadioStateGlyph(){switch(this._state){case 0:return;case 1:if(this._checkRadioStateGlyphs>=1)return;this._bezelDOM.innerHTML=2===this._type?z:W,this._checkRadioStateGlyphs=1;break;case-1:if(this._checkRadioStateGlyphs>=2)return;this._bezelDOM.innerHTML=(2===this._type?z:W)+B,this._checkRadioStateGlyphs=2}}_startCheckRadioAnimation(){var e,t;!0===(null===(t=null===(e=this.controlView)||void 0===e?void 0:e.window)||void 0===t?void 0:t.isKeyWindow)&&(this._checkRadioTimer&&clearTimeout(this._checkRadioTimer),this._bezelDOM.classList.add("animated"),this._bezelDOM.offsetHeight,this._checkRadioTimer=setTimeout(()=>{this._bezelDOM.classList.remove("animated"),this._checkRadioTimer=0},400))}_cancelCheckRadioAnimation(){this._checkRadioTimer&&(clearTimeout(this._checkRadioTimer),this._bezelDOM.classList.remove("animated"),this._checkRadioTimer=0)}get isEnabled(){return!this.dom.hasAttribute("disabled")}set isEnabled(e){this._cancelCheckRadioAnimation(),l(this.dom,"disabled",!e),l(this._bezelDOM,"disabled",!e)}get isHighlighted(){return this._highlighted}set isHighlighted(e){e!==this._highlighted&&(this._highlighted=e,this._checkRadio&&this._startCheckRadioAnimation(),l(this.dom,"highlighted",e),l(this._bezelDOM,"highlighted",e))}get style(){return this._style}set style(e){e!==this._style&&this._setStyleAndType(e,this._type)}get type(){return this._type}set type(e){e!==this._type&&this._setStyleAndType(this._style,e)}_setStyleAndType(e,t){if(this._style=e,this._type=t,this._cancelCheckRadioAnimation(),this.dom.classList.remove("rounded","textured-rounded"),this._bezelDOM.innerHTML="",this._bezelDOM.classList.remove("rounded","textured-rounded","check","radio"),2===t||3===t)this._checkRadio=!0,this._checkRadioStateGlyphs=0,this._addCheckRadioStateGlyph(),this._bezelDOM.classList.add(2===t?"check":"radio"),this._alignment=0,d(this.dom,0),this._applyImage(null);else{switch(this._checkRadio=!1,e){case 0:this.dom.classList.add("rounded"),this._bezelDOM.classList.add("rounded");break;case 1:this.dom.classList.add("textured-rounded"),this._bezelDOM.classList.add("textured-rounded")}this._applyImage(this._image)}}_moveTitleImageToPlace(){let e;switch(this._imagePosition){case 0:e=[this._imageDOM,this._titleDOM];break;case 1:e=[this._titleDOM,this._imageDOM]}let t=!0,i=this._bezelDOM;for(let s of e)null!==s&&(i.after(s),i=s,s.classList.toggle("hi-button-content-head",t),s.classList.remove("hi-button-content-tail"),t=!1);i!==this._bezelDOM&&i.classList.add("hi-button-content-tail")}}const z='<svg viewBox="0 0 14 14" class="hi-button-state-glyph on" xmlns="http://www.w3.org/2000/svg"><path fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" d="M3.75 7.75L6 10.25l4.25-6.5"/></svg>',B='<svg viewBox="0 0 14 14" class="hi-button-state-glyph mixed" xmlns="http://www.w3.org/2000/svg"><path fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" d="M4 7h6"/></svg>',W='<svg viewBox="0 0 14 14" class="hi-button-state-glyph on" xmlns="http://www.w3.org/2000/svg"><circle fill="currentColor" cx="7" cy="7" r="2.75"/></svg>';class HIButton extends HIControl{constructor(e,t,i,s,n=0){let r,o;super(),e instanceof HIImage?(r=null,o=e,this.target=t,this.action=i):t instanceof HIImage||void 0!==s?(r=e,o=t,this.target=i,this.action=s):(r=e,o=null,this.target=t,this.action=i),this._cell=new.target.makeCell(),this._cell.controlView=this,this._cell.type=n,r&&(this._cell.title=r),o&&(this._cell.image=o),this.dom.appendChild(this._cell.dom),this._allowsMixedState=!1}static checkbox(e,t,i){return new HIButton(e,null,t,i,2)}static radioButton(e,t,i){return new HIButton(e,null,t,i,3)}static makeDOM(){let e=document.createElement("span");return e.classList.add("hi-button"),e}static makeCell(){return new HIButtonCell}get cell(){return this._cell}get title(){return this._cell.title}set title(e){this._cell.title=e}get image(){return this._cell.image}set image(e){this._cell.image=e}get imagePosition(){return this._cell.imagePosition}set imagePosition(e){this._cell.imagePosition=e}get imageHugsTitle(){return this._cell.imageHugsTitle}set imageHugsTitle(e){this._cell.imageHugsTitle=e}get alignment(){return this._cell.alignment}set alignment(e){this._cell.alignment=e}get state(){return this._cell.state}set state(e){this._cell.state=e}get type(){return this._cell.type}set type(e){this._cell.type=e}get style(){return this._cell.style}set style(e){this._cell.style=e}get keyDOM(){return this._cell.keyDOM}get allowsMixedState(){return this._allowsMixedState}set allowsMixedState(e){this._allowsMixedState=e}mouseDown(e){if(!this.isEnabled)return super.mouseDown(e);this._cell.isHighlighted=!0}mouseDragged(e){if(!this.isEnabled)return super.mouseDragged(e);this._cell.isHighlighted=e.isMouseInDOM(this.dom)}mouseUp(e){if(!this.isEnabled)return super.mouseUp(e);this._cell.isHighlighted=!1,e.isMouseInDOM(this.dom)&&this._performAction()}keyDown(e){if(this.isEnabled&&" "===e.native.key)this.performClick();else if(3===this._cell.type&&null!==this.superview){let t;switch(e.native.key){case"ArrowUp":case"ArrowLeft":for(t=this.superview.subviews.indexOf(this);t>0;){t-=1;let e=this.superview.subviews[t];if(this._isViewInSameRadioGroup(e))return e.performClick()}break;case"ArrowDown":case"ArrowRight":for(t=this.superview.subviews.indexOf(this);t<this.superview.subviews.length-1;){t+=1;let e=this.superview.subviews[t];if(this._isViewInSameRadioGroup(e))return e.performClick()}}super.keyDown(e)}else super.keyDown(e)}performClick(e){if(!this.isEnabled)return;this._cell.isHighlighted=!0,this._performAction();let t=this.dom.dataset.highlightTimeout;void 0!==t&&clearTimeout(parseInt(t)),this.dom.dataset.highlightTimeout=setTimeout(()=>{this._cell.isHighlighted=!1},100).toString()}_performAction(){var e;switch(this._cell.type){case 0:break;case 1:case 2:switch(this._cell.state){case-1:this._cell.state=1;break;case 0:this._cell.state=this._allowsMixedState?-1:1;break;case 1:this._cell.state=0}break;case 3:if(this._cell.state=1,null!==this.superview)for(let t of this.superview.subviews)t!==this&&this._isViewInSameRadioGroup(t)&&(t._cell.state=0,(null===(e=t.window)||void 0===e?void 0:e.firstResponder)===t&&t.window.makeFirstResponder(this))}null!==this.action&&this.sendAction(this.action,this.target)}get canBecomeKeyView(){if(!super.canBecomeKeyView)return!1;if(3!==this._cell.type)return!0;if(0!==this._cell.state)return!0;if(null===this.superview)return!0;let e=!1,t=!1;for(let i of this.superview.subviews)this._isViewInSameRadioGroup(i)&&(e=i===this,t||(t=0!==i._cell.state));return!t&&e}_isViewInSameRadioGroup(e){return e instanceof HIButton&&(!!e.isEnabled&&(3===e._cell.type&&e.action===this.action))}}const F=[],K=Symbol("HIDrawingViewWholeRect");class HIDrawingView extends HIView{constructor(){super(),this._dirtyRect=null,this._canvasDOM=null,this._canvasScale=1}static makeDOM(){let e=document.createElement("div");return e.classList.add("hi-drawing-view"),e}setNeedsDisplay(e){void 0===e?this._dirtyRect=K:null===this._dirtyRect?this._dirtyRect=e:this._dirtyRect!==K&&(this._dirtyRect=function(e,t){let i=Math.min(e.x,t.x),s=Math.min(e.y,t.y);return{x:i,y:s,width:Math.max(e.x+e.width,t.x+t.width)-i,height:Math.max(e.y+e.height,t.y+t.height)-s}}(this._dirtyRect,e)),super.setNeedsDisplay()}display(){let e=this._dirtyRect;if(null===e)return;e=e===K?this.bounds:T(e);let t=this._canvasDOM.getContext("2d");t.save(),t.scale(this._canvasScale,this._canvasScale),this.isOpaque||t.clearRect(e.x,e.y,e.width,e.height),this._dirtyRect!==K&&(t.beginPath(),t.rect(e.x,e.y,e.width,e.height),t.clip()),this.drawRect(e,t),t.restore(),this._dirtyRect=null}layout(){let{width:e,height:t}=this.bounds;this._canvasScale=window.devicePixelRatio,null!==this._canvasDOM&&(this._canvasDOM.width=e*this._canvasScale,this._canvasDOM.height=t*this._canvasScale)}willUnhide(){let e=F.pop();void 0===e&&(e=document.createElement("canvas"),e.classList.add("hi-drawing-view-canvas")),this._canvasDOM=e,this.dom.prepend(e),this.setNeedsLayout()}willHide(){F.push(this._canvasDOM),this._canvasDOM.remove(),this._canvasDOM=null}get bounds(){let{width:e,height:t}=this.dom.getBoundingClientRect();return{x:0,y:0,width:e,height:t}}drawRect(e,t){}get isOpaque(){return!1}}class HILabel extends HIView{constructor(e=""){super(),this._textNode=document.createTextNode(e),this._textNode.textContent=e,this.dom.appendChild(this._textNode),this._textColor=HIColor.label,this.dom.style.color=this._textColor.cssUsage(),this._alignment=0,this._selectable=!1}static makeDOM(){let e=document.createElement("div");return e.classList.add("hi-label"),e}get string(){return this._textNode.textContent||""}set string(e){this._textNode.textContent=e}get textColor(){return this._textColor}set textColor(e){this._textColor=e,this.dom.style.color=e.cssUsage()}get alignment(){return this._alignment}set alignment(e){this._alignment=e,d(this.dom,e)}get font(){return this.dom.style.font||""}set font(e){this.dom.style.font=e}get isSelectable(){return this._selectable}set isSelectable(e){this._selectable=e,l(this.dom,"selectable",e)}}class _HITitleBarView extends HIView{constructor(){super(),this._contentDOM=document.createElement("div"),this._contentDOM.classList.add("hi-window-title-bar-content"),this.dom.appendChild(this._contentDOM),this._titleDOM=document.createElement("span"),this._titleDOM.classList.add("hi-window-title"),this._contentDOM.appendChild(this._titleDOM),this._contentDOM.style.height=`${this.height}px`,this.widgetButtons=null}static makeDOM(){let e=document.createElement("header");e.classList.add("hi-window-title-bar");let t=document.createElement("div");return t.classList.add("hi-window-title-bar-background"),e.appendChild(t),e}get height(){return 22}setTitle(e){this._titleDOM.textContent=e}setTitleVisible(e){this._titleDOM.style.display=e?"":"none"}setHasWidgetButtons(e){e?(null===this.widgetButtons&&(this.widgetButtons=new _HIWidgetButtons),this.addSubview(this.widgetButtons),this._contentDOM.classList.add("has-widget-buttons")):(null!==this.widgetButtons&&this.widgetButtons.removeFromSuperview(),this._contentDOM.classList.remove("has-widget-buttons"))}insertDOMOfProposedSubview(e,t){if(e!==this.widgetButtons)throw new Error("Unknown subview inserted into _HITitleBarView");this._contentDOM.prepend(e.dom)}acceptsFirstMouse(e){return!0}}class _HIWidgetButtons extends HIView{constructor(){super(...arguments),this._mouseDownButton=null}static makeDOM(){let e=document.createElement("span");e.classList.add("hi-window-widget-buttons");let t=document.createElement("button");t.classList.add("hi-window-widget-button","close"),e.appendChild(t);let i=document.createElement("button");i.classList.add("hi-window-widget-button","miniaturize"),e.appendChild(i);let s=document.createElement("button");return s.classList.add("hi-window-widget-button","zoom"),e.appendChild(s),e}setEnabledOfButton(e,t){this.dom.children[e].disabled=!t}hitTestButton(e){let t=Array.prototype.indexOf.call(this.dom.children,e.native.target);return-1===t?null:t}acceptsFirstMouse(e){return!0}shouldDelayWindowOrdering(e){let t=this.hitTestButton(e);return 0===t||1===t}mouseDown(e){if(this._mouseDownButton=this.hitTestButton(e),null===this._mouseDownButton)return super.mouseDown(e);this.window.preventOrdering(),this.dom.classList.add("active"),this.dom.children[this._mouseDownButton].classList.add("highlighted")}mouseDragged(e){if(null===this._mouseDownButton)return super.mouseDragged(e);let t=e.isMouseInDOM(this.dom.children[this._mouseDownButton]);this.dom.children[this._mouseDownButton].classList.toggle("highlighted",t)}mouseUp(e){if(null===this._mouseDownButton)return super.mouseUp(e);if(e.isMouseInDOM(this.dom.children[this._mouseDownButton])&&0===this._mouseDownButton)this.window.orderOut(this);this.dom.classList.remove("active"),this.dom.children[this._mouseDownButton].classList.remove("highlighted")}}HIAppearance.addCSSVariableProvider("--hi-title-bar-background",e=>e.isDark?"#2d2d2d":"#f6f6f6"),HIAppearance.addCSSVariableProvider("--hi-active-title-bar-background",e=>e.isDark?"linear-gradient(rgba(70, 70, 70, 0.8), rgba(55, 55, 55, 0.8))":"linear-gradient(rgba(236, 236, 236, 0.8), rgba(210, 210, 210, 0.8))"),HIAppearance.addCSSVariableProvider("--hi-title-bar-shadow",e=>e.isDark?"inset rgba(0, 0, 0, 0.8) 0 -1px":"inset rgba(0, 0, 0, 0.1) 0 -1px"),HIAppearance.addCSSVariableProvider("--hi-active-title-bar-shadow",e=>e.isDark?"inset rgba(0, 0, 0, 0.8) 0 -1px,inset rgba(255, 255, 255, 1) 0 1px 1px -1px":"inset rgba(0, 0, 0, 0.75) 0 -1px 1px -1px,inset rgba(255, 255, 255, 1) 0 1px 1px -1px,inset rgba(255, 255, 255, 0.15) 0 1px"),HIAppearance.addCSSVariableProvider("--hi-widget-button-base-x",e=>{let t=e._accentColor===HIColor.systemGray;return-96*(2*+e.isDark+1*+t)+"px"});var U=function(e,t,i,s){var n,r=arguments.length,o=r<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(r<3?n(o):r>3?n(t,i,o):n(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const X=["nw","n","ne","e","se","s","sw","w"];class _HIThemeFrame extends HIView{constructor(){super(),this._frameSizeOnceSet=!1;let e={x:0,y:0,width:300,height:200};this.frame=new _HIFrameRect(e),this.frameDOM=document.createElement("div"),this.frameDOM.classList.add("hi-window"),this.dom.appendChild(this.frameDOM),this.minSize=new _HICheckedSize(68,28),this.maxSize=new _HICheckedSize(1e5,1e5),this.level=0,this.styleMask=0,this.title="",this.titleBar=null,this.contentView=null,this.backgroundColor=null,this.setBackgroundColor(HIColor.windowBackground),this._contentDOM=document.createElement("div"),this._contentDOM.classList.add("hi-window-content"),this.frameDOM.appendChild(this._contentDOM),this._resizersDOM=null,this._resizerDOMs=[],this.setFrame(e),this._frameSizeOnceSet=!1,H(this.frame,this)}static makeDOM(){let e=document.createElement("section");return e.classList.add("hi-window-scene"),e}static get pseudoRoot(){let e=Object.create(_HIThemeFrame.prototype);return e._dom=document.body,e}get appearanceDOM(){return this.frameDOM}setContentView(e){if(this.contentView!==e&&(null!==this.contentView&&(this.contentView._setWindowContent(!1),this.contentView.removeFromSuperview()),this.contentView=e,null!==e)){if(e._setWindowContent(!0),this.addSubview(e),this._frameSizeOnceSet)return;let{width:t,height:i}=L(e.preferredSize);if(t<=0||i<=0)return;let{x:s,y:n}=this.frame;1==(32769&this.styleMask)&&(i+=this.titleBar.height),this.setFrame({x:s,y:n,width:t,height:i})}}insertDOMOfProposedSubview(e,t){switch(e){case this.titleBar:this.frameDOM.prepend(e.dom);break;case this.contentView:this._contentDOM.appendChild(e.dom);break;default:console.error("Unknown subview inserted into _HIThemeFrame"),super.insertDOMOfProposedSubview(e,t)}}setTransform(e,t,i,s,n,r){this.frameDOM.style.transform=`matrix(${e}, ${t}, ${i}, ${s}, ${n}, ${r})`}setFrame(e){if(e===this.frame)return;let{x:t,y:i,width:s,height:n}=T(e);A(this.frame,"x",t),A(this.frame,"y",i),A(this.frame,"width",s),A(this.frame,"height",n),this.frameDOM.style.transform=`translate(${t}px, ${i}px)`,this.frameDOM.style.width=`${s}px`,this.frameDOM.style.height=`${n}px`,this._frameSizeOnceSet=!0,this._updateResizers(),this.setNeedsLayout()}frameDidChange(e,t,i){let s=R(i);switch(s!==i&&A(this.frame,t,s),t){case"x":case"y":this.frameDOM.style.transform=`translate(${e.x}px, ${e.y}px)`;break;case"width":this.frameDOM.style.width=`${s}px`,this._frameSizeOnceSet=!0;break;case"height":this.frameDOM.style.height=`${s}px`,this._frameSizeOnceSet=!0;break;default:return}this._updateResizers(),this.setNeedsLayout()}setMinSize(e){this.minSize.width=e.width,this.minSize.height=e.height,this._updateResizers()}setMaxSize(e){this.maxSize.width=e.width,this.maxSize.height=e.height,this._updateResizers()}setLevel(e){this.level!==e&&(this.level=e,this.dom.style.zIndex=e.toString())}setBackgroundColor(e){this.backgroundColor!==e&&(this.backgroundColor=e,this.frameDOM.style.backgroundColor=e.cssUsage())}setKeyOrMainAppearance(e,t){this.frameDOM.classList.toggle("key",e),this.frameDOM.classList.toggle("main",t),l(this.frameDOM,"key-or-main",e||t)}setStyleMask(e){if(this.styleMask===e)return;this.styleMask=e;let t=!!(8&e);this._setResizable(t);let i=!!(1&e);if(this._setHasTitlebar(i),i){this._setTitlebarCoversContent(!!(32768&e));let i=!!(2&e),s=!!(4&e);i||s||t?(this.titleBar.setHasWidgetButtons(!0),this.titleBar.widgetButtons.setEnabledOfButton(0,i),this.titleBar.widgetButtons.setEnabledOfButton(1,s),this.titleBar.widgetButtons.setEnabledOfButton(2,t)):this.titleBar.setHasWidgetButtons(!1)}}setTitle(e){var t;this.title!==e&&(this.title=e,null===(t=this.titleBar)||void 0===t||t.setTitle(e))}_setHasTitlebar(e){e?(null===this.titleBar&&(this.titleBar=new _HITitleBarView,this.titleBar.setTitle(this.title)),this.insertSubview(this.titleBar,0),this.frameDOM.classList.add("titled")):(null!==this.titleBar&&this.titleBar.removeFromSuperview(),this.frameDOM.classList.remove("titled"))}_setTitlebarCoversContent(e){this.frameDOM.classList.toggle("titlebar-covers-content",e)}_setResizable(e){if(e){if(null===this._resizersDOM){this._resizersDOM=document.createElement("div"),this._resizersDOM.classList.add("hi-window-resizers");for(let e of X){let t=document.createElement("div");t.classList.add("hi-window-resizer",e),this._resizerDOMs.push(t),this._resizersDOM.appendChild(t)}this._resizersDOM.append(this._resizerDOMs[4]),this.frameDOM.appendChild(this._resizersDOM)}}else null!==this._resizersDOM&&(this._resizersDOM.remove(),this._resizersDOM=null,this._resizerDOMs.length=0)}_updateResizers(){if(null!==this.window&&this.window.isInLiveResize)return;if(0===this._resizerDOMs.length)return;let e=this.frame.width<=this.minSize.width,t=this.frame.width>=this.maxSize.width,i=this.frame.height<=this.minSize.height,s=this.frame.height>=this.maxSize.height,n=e&&i,r=t&&s,o=e&&t,a=i&&s,l=o||a,h=this._resizerDOMs;h[7].hidden=o,h[3].hidden=o,h[1].hidden=a,h[5].hidden=a,h[0].hidden=l,h[2].hidden=l,h[4].hidden=l,h[6].hidden=l,h[7].classList.toggle("outward",e),h[3].classList.toggle("outward",e),h[7].classList.toggle("inward",t),h[3].classList.toggle("inward",t),h[1].classList.toggle("outward",i),h[5].classList.toggle("outward",i),h[1].classList.toggle("inward",s),h[5].classList.toggle("inward",s),h[0].classList.toggle("outward",n),h[2].classList.toggle("outward",n),h[4].classList.toggle("outward",n),h[6].classList.toggle("outward",n),h[0].classList.toggle("inward",r),h[2].classList.toggle("inward",r),h[4].classList.toggle("inward",r),h[6].classList.toggle("inward",r)}setNeedsLayout(){var e;super.setNeedsLayout(),null===(e=this.contentView)||void 0===e||e.setNeedsLayout()}get nextResponder(){return this.window}acceptsFirstMouse(e){return!0}mouseDown(e){let t=this._resizerDOMs.indexOf(e.native.target);this.window._performDrag(e,t)}hitTestIgnoringResizers(e){null!==this._resizersDOM&&(this._resizersDOM.style.visibility="hidden");let t=document.elementFromPoint(e.x,e.y),i=null===t?null:this.viewWithDOM(t);return null!==this._resizersDOM&&(this._resizersDOM.style.visibility=""),i}}U([r],_HIThemeFrame,"pseudoRoot",null);class _HIFrameRect extends S{static get observedKeys(){return["x","y","width","height"]}static get observerAction(){return"frameDidChange"}copy(){return{x:this.x,y:this.y,width:this.width,height:this.height}}}HIAppearance.addCSSVariableProvider("--hi-window-glow-visibility",e=>e.isDark?"visible":"hidden"),HIAppearance.addCSSVariableProvider("--hi-window-shadow",e=>e.isDark?"0 0 0 var(--min-pixel) rgba(0, 0, 0, 1), 0 10px 30px rgba(0, 0, 0, 0.35)":"0 0 0 var(--min-pixel) rgba(0, 0, 0, 0.25), 0 10px 30px rgba(0, 0, 0, 0.35)"),HIAppearance.addCSSVariableProvider("--hi-main-window-shadow",e=>e.isDark?"0 0 0 var(--min-pixel) rgba(0, 0, 0, 1), 0 20px 40px rgba(0, 0, 0, 0.55)":"0 0 0 var(--min-pixel) rgba(0, 0, 0, 0.25), 0 20px 40px rgba(0, 0, 0, 0.55)");var $=function(e,t,i,s){var n,r=arguments.length,o=r<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(r<3?n(o):r>3?n(t,i,o):n(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let G=null,Y=!1,q="";function j(e){Y||(null===G?(G=document.createElement("div"),G.classList.add("hi-window-dragging-overlay"),document.body.appendChild(G)):G.hidden=!1,Y=!0),e!==q&&(q=e,G.style.cursor=e)}let J=null,Q=null,Z=!1;class HIWindow extends HIResponder{constructor(){super(),this._frameView=new _HIThemeFrame,this._frameView._setWindow(this),this._contentViewController=null,this._parent=null,this._children=[],this._state=0,this._orderingAnimator=null,this._firstResponder=this,this._mouseSession=null,this._cancelsNextNativeMenu=!1,this._delayedCheckKeyDOMFocus=0,this._focusRingDOM=document.createElement("div"),this._focusRingDOM.classList.add("hi-focus-ring"),this._frameView.frameDOM.appendChild(this._focusRingDOM),this._focusRingTimer=0,this._viewTreeNeedsLayout=!1,this._queuedViewTreeLayout=!1,this._viewTreeNeedsDisplay=!1,this._delayedViewTreeDisplay=0}static get _pseudoRoot(){let e=Object.create(HIWindow.prototype);e._frameView=_HIThemeFrame.pseudoRoot,e._children=[],e._state=2;let t=!1;return document.addEventListener("keydown",()=>{t&&null!==Q&&(Q._checkKeyDOMFocus(),t=!1)},!0),document.addEventListener("blur",()=>{Z||(t=!0)},!0),e}static get viewportFrame(){return{x:0,y:0,width:document.documentElement.clientWidth,height:document.documentElement.clientHeight}}static get visibleViewportFrame(){return{x:window.scrollX,y:window.scrollY,width:window.innerWidth,height:window.innerHeight}}static get windows(){return n(HIWindow._pseudoRoot._children)}static get mainWindow(){return J}static get keyWindow(){return Q}get contentView(){return null===this._frameView.contentView&&this._frameView.setContentView(new HIView),this._frameView.contentView}set contentView(e){if(null!==this._contentViewController)throw new Error("Cannot set content view when content view controller is set.");this._frameView.setContentView(e)}get contentViewController(){return this._contentViewController}set contentViewController(e){this._contentViewController!==e&&(this._contentViewController=e,null!==e&&this._frameView.setContentView(e.view))}get frame(){return this._frameView.frame}set frame(e){this._frameView.setFrame(e)}get level(){return this._frameView.level}set level(e){this._frameView.setLevel(e)}get styleMask(){return this._frameView.styleMask}set styleMask(e){this._frameView.setStyleMask(e)}get backgroundColor(){return this._frameView.backgroundColor}set backgroundColor(e){this._frameView.setBackgroundColor(e)}get title(){return this._frameView.title}set title(e){this._frameView.setTitle(e)}get minSize(){return this._frameView.minSize}set minSize(e){this._frameView.setMinSize(e)}get maxSize(){return this._frameView.maxSize}set maxSize(e){this._frameView.setMaxSize(e)}get appearance(){return this._frameView.appearance}set appearance(e){this._frameView.appearance=e}get effectiveAppearance(){return this._frameView.effectiveAppearance}systemAppearanceDidChange(e){this._frameView._didChangeInheritedAppearance(HIAppearance.system)}_performDrag(e,t){null!==this._mouseSession&&(this._mouseSession.dragsWindow||1===e.native.buttons&&(this._mouseSession={dragsWindow:!0,downAt:{x:e.native.clientX,y:e.native.clientY},original:this._frameView.frame.copy(),type:t,hitThreshold:!1,symmetric:e.native.altKey,onceMoved:!1}))}performDrag(e){this._performDrag(e,-1)}setDraggingCursor(e){null!==this._mouseSession&&j(e)}preventOrdering(){null!==this._mouseSession&&(this._mouseSession.dragsWindow||(this._mouseSession.orderFrontWhenUp=!1))}get isInLiveResize(){return null!==this._mouseSession&&this._mouseSession.dragsWindow}_viewDOMMouseDown(e,t){if(2!==this._state)return;if(e.window!==this)return;if(null===this._mouseSession)this._mouseSession={dragsWindow:!1,view:e,orderFrontWhenUp:!1};else{if(this._mouseSession.dragsWindow)return;{let t=this._mouseSession.view;switch(t.ancestorSharedWith(e)){case t:this._mouseSession.view=e;break;case e:break;default:return}}}let i,s;switch(t.button){case 0:i=new HIEvent(1,t),s="mouseDown";break;case 2:i=new HIEvent(8,t),s="rightMouseDown";break;default:i=new HIEvent(64,t),s="otherMouseDown"}if(HIEvent.push(i),this!==Q){if(null!==Q&&Q.wantsModalWhenKey)return Q.modalMouseDownOutsideWindow(i),HIEvent.pop(i),void(this._mouseSession=null);if(1===i.type&&(i.isMetaKeyDown||(e.shouldDelayWindowOrdering(i)?this._mouseSession.orderFrontWhenUp=!0:this.makeKeyAndOrderFront()),e.needsPanelToBecomeKey||!e.acceptsFirstMouse(i)))return HIEvent.pop(i),void(this._mouseSession=null)}this._firstResponder!==e&&e.needsPanelToBecomeKey&&this.makeFirstResponder(e),e[s](i),HIEvent.pop(i),this._setCancelsNextNativeMenu(!i.allowsNativeDefault),i.allowsNativeDefault?this._checkKeyDOMFocus():0===this._delayedCheckKeyDOMFocus&&(this._delayedCheckKeyDOMFocus=setTimeout(()=>{this._delayedCheckKeyDOMFocus=0,this._checkKeyDOMFocus()})),document.addEventListener("mousemove",this,!0),document.addEventListener("mouseup",this,!0)}_claimMouseSession(e,t){if(null!==this._mouseSession)return!1;if(2!==this._state)return!1;if(e.window!==this)return!1;if(null===t){let t=HIEvent.current;if(null===t||"mousedown"!==t.native.type)return!1;this._mouseSession={dragsWindow:!1,view:e,orderFrontWhenUp:!1}}else{if(null===t._mouseSession)return!1;if(t._mouseSession.dragsWindow)return!1;this._mouseSession=t._mouseSession,this._mouseSession.view=e}return document.addEventListener("mousemove",this,!0),document.addEventListener("mouseup",this,!0),!0}_discardMouseSession(){this._mouseSession=null,document.removeEventListener("mousemove",this,!0),document.removeEventListener("mouseup",this,!0),Y&&(G.hidden=!0,G.removeAttribute("style"),q="",Y=!1)}handleEvent(e){switch(e.type){case"mousemove":return this._handleDOMMouseMove(e);case"mouseup":return this._handleDOMMouseUp(e);case"contextmenu":return this._handleDOMContextMenu(e)}}_setCancelsNextNativeMenu(e){e!==this._cancelsNextNativeMenu&&(this._cancelsNextNativeMenu=e,e?document.addEventListener("contextmenu",this):document.removeEventListener("contextmenu",this))}_handleDOMMouseMove(e){if(this._setCancelsNextNativeMenu(!1),null===this._mouseSession)return this._discardMouseSession();if(0!==(e.movementX|e.movementY))if(this._mouseSession.dragsWindow){if(0===e.buttons)return this._handleDOMMouseUp(e);let t=e.altKey;if(t!==this._mouseSession.symmetric)return this._mouseSession.downAt={x:e.clientX,y:e.clientY},this._mouseSession.original=this._frameView.frame.copy(),void(this._mouseSession.symmetric=t);const i=4;let s=e.clientX-this._mouseSession.downAt.x,n=e.clientY-this._mouseSession.downAt.y;if(-1!==this._mouseSession.type&&!this._mouseSession.hitThreshold){let e=Math.abs(s),t=Math.abs(n);switch(this._mouseSession.type){case 1:case 5:e>i&&t<i&&(this._mouseSession.type=-1);break;case 7:case 3:e<i&&t>i&&(this._mouseSession.type=-1)}if(!(e>i||t>i)){return void j(function(e){switch(e%4){case 0:case 4:return"nwse-resize";case 1:return"ns-resize";case 2:return"nesw-resize";case 3:return"ew-resize";default:return"default"}}(this._mouseSession.type))}this._mouseSession.hitThreshold=!0}let r=Object.assign({},this._mouseSession.original),o=function(e,t,i,s,n,r){switch(t){case-1:return e.x+=s,e.y+=n,"";case 0:return i?(e.x+=s,e.y+=n,e.width-=2*s,e.height-=2*n):(e.x+=s,e.y+=n,e.width-=s,e.height-=n),s<-r&&n<-r?"se-resize":s>r&&n>r?"nw-resize":"nwse-resize";case 1:return i?(e.y+=n,e.height-=2*n):(e.y+=n,e.height-=n),n<-r?"s-resize":n>r?"n-resize":"ns-resize";case 2:return i?(e.x-=s,e.y+=n,e.width+=2*s,e.height-=2*n):(e.y+=n,e.width+=s,e.height-=n),s>r&&n<-r?"sw-resize":s<-r&&n>r?"ne-resize":"nesw-resize";case 3:return i?(e.x-=s,e.width+=2*s):e.width+=s,s>r?"w-resize":s<-r?"e-resize":"ew-resize";case 4:return i?(e.x-=s,e.y-=n,e.width+=2*s,e.height+=2*n):(e.width+=s,e.height+=n),s>r&&n>r?"nw-resize":s<-r&&n<-r?"se-resize":"nwse-resize";case 5:return i?(e.y-=n,e.height+=2*n):e.height+=n,n>r?"n-resize":n<-r?"s-resize":"ns-resize";case 6:return i?(e.x+=s,e.y-=n,e.width-=2*s,e.height+=2*n):(e.x+=s,e.width-=s,e.height+=n),s<-r&&n>r?"ne-resize":s>r&&n<-r?"sw-resize":"nesw-resize";case 7:return i?(e.x+=s,e.width-=2*s):(e.x+=s,e.width-=s),s<-r?"e-resize":s>r?"w-resize":"ew-resize"}}(r,this._mouseSession.type,t,s,n,i);!function(e,t,i,s,n){if(e.width<s.width||e.width>n.width){let r=e.width<s.width?s.width:n.width;if(i){let t=(r-e.width)/2;e.x-=t,e.width=r}else switch(t){case 0:case 7:case 6:e.x+=e.width-r;default:e.width=r}}if(e.height<s.height||e.height>n.height){let r=e.height<s.height?s.height:n.height;if(i){let t=(r-e.height)/2;e.y-=t,e.height=r}else switch(t){case 0:case 1:case 2:e.y+=e.height-r;default:e.height=r}}}(r,this._mouseSession.type,t,this._frameView.minSize,this._frameView.maxSize),j(o),this._frameView.setFrame(r),this._mouseSession.onceMoved=!0}else{if(0===e.buttons)return this._discardMouseSession();if(this._mouseSession.view.window!==this)return this._discardMouseSession();let t,i;switch(!0){case!!(1&e.buttons):t=new HIEvent(2,e),i="mouseDragged";break;case!!(2&e.buttons):t=new HIEvent(16,e),i="rightMouseDragged";break;default:t=new HIEvent(128,e),i="otherMouseDragged"}HIEvent.push(t),this._mouseSession.view[i](t),HIEvent.pop(t)}}_handleDOMMouseUp(e){if(null===this._mouseSession)return this._discardMouseSession();if(this._mouseSession.dragsWindow){if(this._mouseSession.onceMoved){let{x:e,y:t,width:i,height:s}=this._frameView.frame;this._discardMouseSession(),this._frameView.setFrame({x:e,y:t,width:i,height:s})}else if(-1!==this._mouseSession.type){let{clientX:t,clientY:i}=e;t+=window.scrollX,i+=window.scrollY;let s=this._frameView.hitTestIgnoringResizers({x:t,y:i});if(null!==s){let t=new HIEvent(1,e);HIEvent.push(t),s.mouseDown(t),HIEvent.pop(t);let i=new HIEvent(4,e);HIEvent.push(i),s.mouseUp(i),HIEvent.pop(i),this._setCancelsNextNativeMenu(!i.allowsNativeDefault)}}}else{if(this._mouseSession.view.window===this){let t,i;switch(e.button){case 0:t=new HIEvent(4,e),i="mouseUp";break;case 2:t=new HIEvent(32,e),i="rightMouseUp";break;default:t=new HIEvent(256,e),i="otherMouseUp"}HIEvent.push(t),this._mouseSession.view[i](t),HIEvent.pop(t),this._setCancelsNextNativeMenu(!t.allowsNativeDefault)}this._mouseSession.orderFrontWhenUp&&this.makeKeyAndOrderFront()}0===e.buttons&&this._discardMouseSession()}_handleDOMContextMenu(e){e.preventDefault(),this._setCancelsNextNativeMenu(!1)}get wantsModalWhenKey(){return!1}modalMouseDownOutsideWindow(e){}get isMainWindow(){return this===J}get canBecomeMainWindow(){return!!(9&this._frameView.styleMask)}makeMainWindow(){this.becomeMainWindow()}becomeMainWindow(){0!==this._state&&this!==J&&this.canBecomeMainWindow&&(null!==J&&J.resignMainWindow(),J=this,this._frameView.setKeyOrMainAppearance(this===Q,!0),HINotificationCenter.default.post(HIWindow.didBecomeMainNotification,this))}resignMainWindow(){this===J&&(J=null,this._frameView.setKeyOrMainAppearance(this===Q,!1),HINotificationCenter.default.post(HIWindow.didResignMainNotification,this))}get isKeyWindow(){return this===Q}makeKeyWindow(){this.becomeKeyWindow(),this.becomeMainWindow()}becomeKeyWindow(){0!==this._state&&this!==Q&&(null!==Q&&Q.resignKeyWindow(),Q=this,this._frameView.setKeyOrMainAppearance(!0,this===J),this._checkKeyDOMFocus(),HINotificationCenter.default.post(HIWindow.didBecomeKeyNotification,this))}resignKeyWindow(){this===Q&&(Q=null,this._frameView.setKeyOrMainAppearance(!1,this===J),Z=!0,document.body.focus(),Z=!1,HINotificationCenter.default.post(HIWindow.didResignKeyNotification,this))}_resignMainAndMakeNextMainWindow(){if(this.resignMainWindow(),null!==J)return;let e=this._windowBeneath();for(;null!==e;){if(e.becomeMainWindow(),null!==J)return;e=e._windowBeneath()}}_resignKeyAndMakeNextKeyWindow(){if(this.resignKeyWindow(),null!==Q)return;let e=J;for(null!==e&&e!==this||(e=this._windowBeneath());null!==e;){if(e.becomeKeyWindow(),null!==Q)return;e=e._windowBeneath()}}_windowBeneath(){if(null===this._parent)return null;if(2!==this._parent._state)return null;for(let e=this._parent._children.indexOf(this)-1;e>=0;e-=1){let t=this._parent._children[e];if(2===t._state)return t}return null}get isVisible(){return 0!==this._state}_setState(e){switch(this._state=e,e){case 0:this._cancelDelayedViewTreeDisplay(),this._frameView._windowDidDisappear(),HINotificationCenter.default.removeObserver(this,HIAppearance.didChangeSystemAppearanceNotification);break;case 1:this._triggerDelayedViewTreeLayoutIfNeeded(),this._startDelayedViewTreeDisplayIfNeeded(),this._frameView._windowWillAppear(),HINotificationCenter.default.addObserver(this,"systemAppearanceDidChange",HIAppearance.didChangeSystemAppearanceNotification),this._frameView._didChangeInheritedAppearance(HIAppearance.system);break;case 2:this._frameView._windowDidAppear();break;case 3:this._frameView._windowWillDisappear()}}_attachToParent(e){if(this._parent===e){let t=e._children.indexOf(this);return void(t!==e._children.length-1&&(e._children.splice(t,1),e._children.push(this),e._frameView.dom.appendChild(this._frameView.dom)))}if(null!==this._parent&&this._detachFromParent(),this._parent=e,e._children.push(this),e._frameView.dom.appendChild(this._frameView.dom),0===e._state)return;for(let e of o(this,"_children"))null!==e._orderingAnimator&&(e._orderingAnimator.cancel(),e._orderingAnimator=null),1!==e._state&&e._setState(1),e._makeInitialFirstResponder();let t=()=>{for(let e of o(this,"_children"))2!==e._state&&e._setState(2);this._orderingAnimator=null};this._orderingAnimator=this.openingAnimator(),null===this._orderingAnimator?t():this._orderingAnimator.play().then(t)}_detachFromParent(){if(null===this._parent)return;let e=this._parent;this._parent=null;let t=e._children.indexOf(this);if(e._children.splice(t,1),0===e._state)return void this._frameView.dom.remove();for(let e of o(this,"_children"))null!==e._orderingAnimator&&(e._orderingAnimator.cancel(),e._orderingAnimator=null),3!==e._state&&e._setState(3),e._resignMainAndMakeNextMainWindow(),e._resignKeyAndMakeNextKeyWindow();let i=()=>{for(let e of o(this,"_children"))0!==e._state&&e._setState(0),e._resignMainAndMakeNextMainWindow(),e._resignKeyAndMakeNextKeyWindow();this._frameView.dom.remove(),this._orderingAnimator=null};this._orderingAnimator=this.closingAnimator(),null===this._orderingAnimator?i():this._orderingAnimator.play().then(i)}openingAnimator(){return null}closingAnimator(){return null}get parent(){return this._parent===HIWindow._pseudoRoot?null:this._parent}get children(){return n(this._children)}addChildWindow(e){this._attachToParent(e)}removeChildWindow(e){if(e._parent!==this)throw new Error("The window is not a child of this window.");e._detachFromParent()}orderFront(e){let t=this;for(;null!==t._parent&&t._parent!==HIWindow._pseudoRoot;)t=t._parent;t._attachToParent(HIWindow._pseudoRoot)}orderOut(e){this._detachFromParent()}makeKeyAndOrderFront(e){this.orderFront(e),this.makeKeyWindow()}get firstResponder(){return this._firstResponder}makeFirstResponder(e){return e===this._firstResponder||!(this._firstResponder!==this&&!this._firstResponder.resignFirstResponder()&&this._firstResponder.window===this)&&(null===e||e===this?(this._firstResponder=this,this._checkKeyDOMFocus(),this._updateFocusRing(),this.becomeFirstResponder(),!0):e instanceof HIView&&e.window===this&&e.becomeFirstResponder()?(this._firstResponder=e,this._checkKeyDOMFocus(),this._updateFocusRing(),!0):(this._firstResponder=this,this._checkKeyDOMFocus(),this._updateFocusRing(),this.becomeFirstResponder(),!1))}_makeInitialFirstResponder(){let e=this._firstResponder;if(e instanceof HIView&&e.window===this&&!e.acceptsFirstResponder)return;let t=this.contentView;t.canBecomeKeyView||(t=t.nextValidKeyView),this.makeFirstResponder(t)}_checkKeyDOMFocus(){if(this!==Q)return;let e=(this._firstResponder===this?this._frameView:this._firstResponder).keyDOM;if(document.activeElement!==e){const t="[tabindex], a, :is(button, input, select, textarea):not(:disabled)";e.matches(t)||(e.tabIndex=0),Z=!0,e.focus(),Z=!1}}_updateFocusRing(e=!0){if(e&&(e=2===this._state),0!==this._focusRingTimer&&(clearTimeout(this._focusRingTimer),this._focusRingTimer=0,this._focusRingDOM.classList.remove("animated")),this._firstResponder instanceof HIView&&this._firstResponder.allowsFocusRing){let t=this._firstResponder.keyDOM,{x:i,y:s,width:n,height:r}=t.getBoundingClientRect(),{x:o,y:a}=this._frameView.frame;i+=window.scrollX-o,s+=window.scrollY-a,this._focusRingDOM.style.left=i+"px",this._focusRingDOM.style.top=s+"px",this._focusRingDOM.style.width=n+"px",this._focusRingDOM.style.height=r+"px",this._focusRingDOM.style.borderRadius=getComputedStyle(t).borderRadius,this._focusRingDOM.hidden=!1,e&&(this._focusRingDOM.classList.add("animated"),this._focusRingTimer=setTimeout(()=>{this._focusRingTimer=0,this._focusRingDOM.classList.remove("animated")},250))}else this._focusRingDOM.hidden=!0}_setViewTreeNeedsLayout(){this._viewTreeNeedsLayout||(this._viewTreeNeedsLayout=!0,0!==this._state&&this._triggerDelayedViewTreeLayoutIfNeeded())}_triggerDelayedViewTreeLayoutIfNeeded(){this._viewTreeNeedsLayout&&(this._queuedViewTreeLayout||(this._queuedViewTreeLayout=!0,queueMicrotask(()=>{this._queuedViewTreeLayout=!1,this._viewTreeNeedsLayout&&0!==this._state&&(this._frameView.layoutSubtreeIfNeeded(),this._viewTreeNeedsLayout=!1)})))}_setViewTreeNeedsDisplay(){this._viewTreeNeedsDisplay||(this._viewTreeNeedsDisplay=!0,0!==this._state&&this._startDelayedViewTreeDisplayIfNeeded())}_startDelayedViewTreeDisplayIfNeeded(){this._viewTreeNeedsDisplay&&(this._delayedViewTreeDisplay||(this._delayedViewTreeDisplay=requestAnimationFrame(()=>{this._delayedViewTreeDisplay=0,this._frameView.displayIfNeeded(),this._viewTreeNeedsDisplay=!1})))}_cancelDelayedViewTreeDisplay(){0!==this._delayedViewTreeDisplay&&(cancelAnimationFrame(this._delayedViewTreeDisplay),this._delayedViewTreeDisplay=0)}selectNextKeyView(e){let t=this._firstResponder===this?this._frameView:this._firstResponder;do{t=t.nextValidKeyView}while(null!==t&&!this.makeFirstResponder(t))}selectPreviousKeyView(e){let t=this._firstResponder===this?this._frameView:this._firstResponder;do{t=t.previousValidKeyView}while(null!==t&&!this.makeFirstResponder(t))}keyDown(e){"Tab"===e.native.key?e.native.shiftKey?this.selectPreviousKeyView():this.selectNextKeyView():super.keyDown(e)}targetForAction(e,t,i){if(null!==t){let i=Reflect.get(t,e);if("function"==typeof i&&i.length<=1)return t}let s=this._firstResponder;for(;null!==s;){let t=Reflect.get(s,e);if("function"==typeof t&&t.length<=1)return s;s=s.nextResponder}return null}sendAction(e,t,i){let s=this.targetForAction(e,t,i);return null!==s&&(Reflect.get(s,e).call(s,i),!0)}}HIWindow.didBecomeKeyNotification="HIWindowDidBecomeKeyNotification",HIWindow.didResignKeyNotification="HIWindowDidResignKeyNotification",HIWindow.didBecomeMainNotification="HIWindowDidBecomeMainNotification",HIWindow.didResignMainNotification="HIWindowDidResignMainNotification",$([r],HIWindow,"_pseudoRoot",null);class HITrackingArea{constructor(e,t){this._dom=e,this._options=t,this._owner=null}get owner(){return this._owner}_setOwner(e){this._owner!==e&&(null!==this._owner&&this._stopTracking(),this._owner=e,null!==this._owner&&this._startTracking())}_startTracking(){1&this._options&&(this._dom.addEventListener("mouseenter",this),this._dom.addEventListener("mouseleave",this)),2&this._options&&this._dom.addEventListener("mousemove",this)}_stopTracking(){1&this._options&&(this._dom.removeEventListener("mouseenter",this),this._dom.removeEventListener("mouseleave",this)),2&this._options&&this._dom.removeEventListener("mousemove",this)}handleEvent(e){if(null===this._owner)return;let t,i;switch(e.type){case"mouseenter":t=new HIEvent(512,e),i="mouseEntered";break;case"mouseleave":t=new HIEvent(1024,e),i="mouseExited";break;case"mousemove":t=new HIEvent(2048,e),i="mouseMoved";break;default:return}HIEvent.push(t),this._owner[i](t),HIEvent.pop(t)}}class RangeSet{constructor(e,t){return void 0===e?(this._bounds=[],void(this._count=0)):(void 0===t&&(t=e+1),e<t?(this._bounds=[e,t],void(this._count=t-e)):(this._bounds=[],void(this._count=0)))}get count(){return this._count}get first(){return 0===this._count?null:this._bounds[0]}get last(){return 0===this._count?null:this._bounds[this._bounds.length-1]-1}*[Symbol.iterator](){for(let e=0;e<this._bounds.length;e+=2){let t=this._bounds[e],i=this._bounds[e+1];for(let e=t;e<i;e+=1)yield e}}*reversed(){for(let e=this._bounds.length-2;e>=0;e-=2){let t=this._bounds[e];for(let i=this._bounds[e+1]-1;i>=t;i-=1)yield i}}*ranges(){for(let e=0;e<this._bounds.length;e+=2)yield[this._bounds[e],this._bounds[e+1]]}*reversedRanges(){for(let e=this._bounds.length-2;e>=0;e-=2)yield[this._bounds[e],this._bounds[e+1]]}contains(e,t=e+1){if(0===this._count)return!1;if(!(e<t))return!1;let i=0,s=this._bounds.length;for(;i<s;){let n=i+s>>>2<<1,r=this._bounds[n],o=this._bounds[n+1];if(t<=r)s=n;else{if(!(e>=o))return e>=r&&t<=o;i=n+2}}return!1}insert(e,t=e+1){if(!(e<t))return;if(0===this._count||e>this._bounds[this._bounds.length-1])return this._bounds.push(e,t),void(this._count+=t-e);if(e===this._bounds[this._bounds.length-1])return this._bounds[this._bounds.length-1]=t,void(this._count+=t-e);let i=0,s=this._bounds.length;for(;i<s;){let t=i+s>>>2<<1,n=this._bounds[t],r=this._bounds[t+1];if(e<n)s=t;else{if(!(e>r)){e=n,i=t;break}i=t+2}}s=i;let n=0;for(;s<this._bounds.length;){let e=this._bounds[s];if(t<e)break;let i=this._bounds[s+1];if(s+=2,n+=i-e,t<=i){t=i;break}}this._bounds.splice(i,s-i,e,t),this._count+=t-e-n}insertSpanIn(e,t){this.insertGapIn(e,t),this.insert(e,t)}insertGapIn(e,t){if(!(e<t))return;if(0===this._count)return;let i=t-e,s=0,n=this._bounds.length;for(;s<n;){let r=s+n>>>2<<1,o=this._bounds[r],a=this._bounds[r+1];if(e<o)n=r;else{if(!(e>=a)){if(e===o){s=r;break}this._bounds[r+1]=e,this._bounds.splice(r+2,0,t,a+i),s=r+4;break}s=r+2}}for(let e=s;e<this._bounds.length;e+=2)this._bounds[e]+=i,this._bounds[e+1]+=i}_remove(e,t){if(!(e<t))return-1;if(0===this._count)return-1;let i=0,s=this._bounds.length;for(;i<s;){let n=i+s>>>2<<1,r=this._bounds[n],o=this._bounds[n+1];if(e<r)s=n;else{if(!(e>=o)){if(e===r){i=n;break}if(t>=o){this._bounds[n+1]=e,this._count-=o-e,i=n+2;break}return this._bounds[n+1]=e,this._bounds.splice(n+2,0,t,o),this._count-=t-e,n+2}i=n+2}}s=i;let n=0;for(;s<this._bounds.length;){let e=this._bounds[s];if(t<=e)break;let i=this._bounds[s+1];if(t<i){this._bounds[s]=t,this._count-=t-e;break}s+=2,n+=i-e}return this._bounds.splice(i,s-i),this._count-=n,0===this._bounds.length&&(this._count=0),i}remove(e,t=e+1){this._remove(e,t)}removeSpanIn(e,t){let i=this._remove(e,t);if(-1===i)return;let s=t-e;for(let e=i;e<this._bounds.length;e+=2)this._bounds[e]-=s,this._bounds[e+1]-=s;0!==i&&i!==this._bounds.length&&this._bounds[i]===this._bounds[i-1]&&this._bounds.splice(i-1,2)}removeAll(){this._bounds.splice(0,this._bounds.length),this._count=0}toggle(e,t=e+1){if(!(e<t))return;if(0===this._count)return this._bounds.push(e,t),void(this._count+=t-e);let i=0,s=this._bounds.length;for(;i<s;){let t=i+s>>>1;e<=this._bounds[t]?s=t:i=t+1}for(s=i;s<this._bounds.length;){if(t<=this._bounds[s])break;s+=1}i!==this._bounds.length&&e===this._bounds[i]?(this._bounds.splice(i,1),s-=1):(this._bounds.splice(i,0,e),s+=1),s!==this._bounds.length&&t===this._bounds[s]?this._bounds.splice(s,1):this._bounds.splice(s,0,t);let n=0;for(let e=0;e<this._bounds.length;e+=2)n+=this._bounds[e+1]-this._bounds[e];this._count=n}equals(e){if(this._bounds===e._bounds)return!0;if(this._bounds.length!==e._bounds.length)return!1;for(let t=0;t<this._bounds.length;++t)if(this._bounds[t]!==e._bounds[t])return!1;return!0}assignFrom(e){this._bounds=e._bounds.slice(),this._count=e._count}copy(){let e=new RangeSet;return e._bounds=this._bounds.slice(),e._count=this._count,e}union(e){let t=new RangeSet,i=t._bounds,s=0,n=Number.NaN,r=0,o=0;for(;r<this._bounds.length&&o<e._bounds.length;){let t=this._bounds[r],a=e._bounds[o],l=0,h=0;t<a?(l=t,h=this._bounds[r+1],r+=2):(l=a,h=e._bounds[o+1],o+=2),h<=n||(l<=n?(i[i.length-1]=h,s+=h-n):(i.push(l,h),s+=h-l),n=h)}function a(e,t,i,s){let n=0;for(;i<t.length;){let r=t[i+1];if(r<s){i+=2;continue}let o=t[i];o<=s?(e[e.length-1]=r,n+=r-s):(e.push(o,r),n+=r-o),i+=2;break}for(;i<t.length;)e.push(t[i],t[i+1]),n+=t[i+1]-t[i],i+=2;return n}return r<this._bounds.length?s+=a(i,this._bounds,r,n):o<e._bounds.length&&(s+=a(i,e._bounds,o,n)),t._count=s,t}intersection(e){let t=new RangeSet,i=t._bounds,s=0,n=0,r=0;for(;n<this._bounds.length&&r<e._bounds.length;){let t=this._bounds[n],o=this._bounds[n+1],a=e._bounds[r],l=e._bounds[r+1];if(o>a&&t<l){let e=Math.max(t,a),n=Math.min(o,l);i.push(e,n),s+=n-e}o===l?(n+=2,r+=2):o<l?n+=2:r+=2}return t._count=s,t}difference(e){let t=this.copy();for(let i=0;i<e._bounds.length;i+=2)t.remove(e._bounds[i],e._bounds[i+1]);return t}symmetricDifference(e){let t,i;this._bounds.length<e._bounds.length?(t=e,i=this):(t=this,i=e);let s=t.copy();for(let e=0;e<i._bounds.length;e+=2)s.toggle(i._bounds[e],i._bounds[e+1]);return s}}const ee=HIColor.windowBackground.withAlpha(.65),te=HIColor.windowBackground.withAlpha(.75),ie=HIColor.windowBackground.withAlpha(.85),se=HIColor.windowBackground.blending(HIColor.systemGray,.5).withAlpha(.5),ne=HIColor.controlAccent.withAlpha(.75);function re(e,t){switch(t){case 0:e.style.backgroundColor=ee.cssUsage(),e.classList.add("hi-backdrop-translucency");break;case 1:e.style.backgroundColor=te.cssUsage(),e.classList.add("hi-backdrop-translucency");break;case 2:e.style.backgroundColor=ie.cssUsage(),e.classList.add("hi-backdrop-translucency");break;case 3:e.style.backgroundColor=se.cssUsage(),e.classList.add("hi-backdrop-translucency");break;case 4:e.style.backgroundColor=ne.cssUsage(),e.classList.add("hi-backdrop-translucency","monotone")}}class HIMenuItem{constructor(e,t){this._menu=null,this._separator=!1,this._title=e,this._image=null,this._state=0,this._enabled=!0,this._changedKey=null,this._target=null,this._action=t,this._stateImages=[null,null,null]}static separator(){let e=new HIMenuItem("",null);return e._enabled=!1,e._separator=!0,e}get menu(){return this._menu}get title(){return this._title}set title(e){var t;this._separator||(this._title=e,this._changedKey="title",null===(t=this._menu)||void 0===t||t.itemChanged(this),this._changedKey=null)}get image(){return this._image}set image(e){var t;this._separator||(this._image=e,this._changedKey="image",null===(t=this._menu)||void 0===t||t.itemChanged(this),this._changedKey=null)}get state(){return this._state}set state(e){var t;this._separator||(this._state=e,this._changedKey="state",null===(t=this._menu)||void 0===t||t.itemChanged(this),this._changedKey=null)}get isEnabled(){return this._enabled}set isEnabled(e){var t;this._separator||(this._enabled=e,this._changedKey="isEnabled",null===(t=this._menu)||void 0===t||t.itemChanged(this),this._changedKey=null)}get target(){return this._target}set target(e){this._separator||(this._target=e)}get action(){return this._action}set action(e){this._separator||(this._action=e)}get isSeparator(){return this._separator}imageFor(e){let t=this._stateImages[e+1];return null===t&&(1===e?t=HIImage.menuStateOn:-1===e&&(t=HIImage.menuStateMixed)),t}setImageFor(e,t){this._stateImages[e+1]=t}}class HIMenu{constructor(){this._items=[],this._view=null}get items(){return n(this._items)}addItem(e,t){let i="string"==typeof e?new HIMenuItem(e,void 0===t?null:t):e;this.insertItem(i,this._items.length)}insertItem(e,t){var i;if(t<0||t>this._items.length)throw new RangeError(`Index ${t} out of bounds 0...${this._items.length}`);null!==e.menu&&e.menu.removeItemAt(e.menu.items.indexOf(e)),e._menu=this,this._items.splice(t,0,e),null===(i=this._view)||void 0===i||i.didInsertItemAt(t),HINotificationCenter.default.post(HIMenu.didAddItemNotification,this,t)}removeItemAt(e){var t;if(e<0||e>=this._items.length)throw new RangeError(`Index ${e} out of bounds 0..<${this._items.length}`);this._items[e]._menu=null,this._items.splice(e,1),null===(t=this._view)||void 0===t||t.didRemoveItemAt(e),HINotificationCenter.default.post(HIMenu.didRemoveItemNotification,this,e)}itemChanged(e){var t;let i=this._items.indexOf(e);if(i<0)throw new RangeError("Item not found in the menu");null===(t=this._view)||void 0===t||t.didChangeItemAt(i),HINotificationCenter.default.post(HIMenu.didChangeItemNotification,this,i)}indexOfItemForCharacter(e,t=0){let i=-1,s=1/0,n=e[0].toLowerCase().codePointAt(0);for(let e=0;e<this._items.length;++e){let r=(t+e)%this._items.length,o=this._items[r];if(!o.isEnabled)continue;if(0===o.title.length)continue;let a=o.title[0].toLowerCase().codePointAt(0)-n;if(!(a<0)){if(0===a)return r;if(a<s)s=a,i=r;else if(a===s){let e=this._items[i];this._items[r].title.length<e.title.length&&(i=r)}}}return i}update(){null===this._view&&(this._view=new _HIMenuView(this))}popUpContextMenu(e,t){this.update();let i={x:e.native.clientX,y:e.native.clientY,width:0,height:0};this._view.openAround(i,-1,t)}popUpPositioningItem(e,t,i){this.update();let{x:s,y:n}=t.dom.getBoundingClientRect();s+=window.scrollX+((null==i?void 0:i.x)||0),n+=window.scrollY+((null==i?void 0:i.y)||0),this._view.openAround({x:s,y:n,width:0,height:0},this._items.indexOf(e),t)}_popUpPopUpButton(e){this.update();let t,i=e.pullsDown?-1:e.indexOfSelectedItem,s=e.cell.dom,n=s.getBoundingClientRect();if(-1!==i&&s.childElementCount>1){t={x:s.children[1].getBoundingClientRect().x,y:n.y,width:0,height:0}}else t={x:n.x,y:n.y,width:n.width,height:n.height},t.y-=1,t.height+=2;t.x+=window.scrollX,t.y+=window.scrollY,this._view.openAround(t,i,e,-1!==i)}}HIMenu.didAddItemNotification="HIMenuDidAddItemNotification",HIMenu.didRemoveItemNotification="HIMenuDidRemoveItemNotification",HIMenu.didChangeItemNotification="HIMenuDidChangeItemNotification",HIMenu.didBeginTrackingNotification="HIMenuDidBeginTrackingNotification",HIMenu.didEndTrackingNotification="HIMenuDidEndTrackingNotification",HIMenu.willSendActionNotification="HIMenuWillSendActionNotification",HIMenu.didSendActionNotification="HIMenuDidSendActionNotification";class _HIMenuView extends HIView{constructor(e){super(),this._menu=e,this._contentDOM=document.createElement("div"),this._contentDOM.classList.add("hi-menu-content"),this.dom.appendChild(this._contentDOM),this._rows=e.items.map((e,t)=>{let i=this._makeRowAt(t);return this._contentDOM.appendChild(i.dom),i}),this._accDelta=0,this._highlightedIndex=-1,this._initialIndex=-1,this._hotIndex=-1,this._allowsUpdate=!1,this._opaque=!1,this._mouseDownAt=-1,this._mouseOnceReleased=!1,this._dirtyIndices=new RangeSet(0,this._rows.length),this.addTrackingArea(new HITrackingArea(this._contentDOM,3)),this._backdropDOM=document.createElement("div"),this._backdropDOM.classList.add("hi-menu-backdrop"),this._highlightDOM=document.createElement("div"),this._highlightDOM.classList.add("hi-menu-backdrop","selection"),this._contentDOM.prepend(this._backdropDOM,this._highlightDOM),re(this._backdropDOM,0),re(this._highlightDOM,4),this._buttonCapDOM=null,this._fromButton=!1,this._contextView=null,this._flashTimer=0}static makeDOM(){let e=document.createElement("div");return e.classList.add("hi-menu"),e.role="menu",e}_makeRowAt(e){let t=this._menu.items[e];if(t.isSeparator){let e=document.createElement("hr");return e.classList.add("hi-menu-separator"),{item:t,dom:e,cell:null}}{let e=new _HIMenuItemCell,i=document.createElement("div");return i.classList.add("hi-menu-item"),i.role="menuitem",i.appendChild(e.dom),{item:t,dom:i,cell:e}}}_updateDirtyItems(){var e;for(let t of this._dirtyIndices){let i=this._rows[t];null===(e=i.cell)||void 0===e||e.update(i.item)}this._dirtyIndices.removeAll()}didInsertItemAt(e){var t;let i=this._makeRowAt(e);e===this._rows.length?this._contentDOM.appendChild(i.dom):this._contentDOM.insertBefore(i.dom,this._rows[e].dom),this._rows.splice(e,0,i),null===(t=i.cell)||void 0===t||t.update(i.item),this._dirtyIndices.insertGapIn(e,e+1)}didRemoveItemAt(e){this._rows[e].dom.remove(),this._rows.splice(e,1),this._dirtyIndices.removeSpanIn(e,e+1)}didChangeItemAt(e){var t;if(this._allowsUpdate){let i=this._rows[e];null===(t=i.cell)||void 0===t||t.update(i.item)}else this._dirtyIndices.insert(e,e+1)}offsetOfItemAt(e){let t=this._rows[e].dom.offsetTop;return{x:null===this._rows[e].cell?0:ae,y:t}}get originOutset(){let e=parseFloat(this._contentDOM.style.marginLeft||"0"),t=parseFloat(this._contentDOM.style.marginTop||"0");return{x:this.dom.scrollLeft-e,y:this.dom.scrollTop-t}}set originOutset(e){this._opaque?(this._contentDOM.style.marginLeft="",this._contentDOM.style.marginTop="",this.dom.scrollLeft=e.x,this.dom.scrollTop=e.y):(this._contentDOM.style.marginLeft=-e.x+"px",this._contentDOM.style.marginTop=-e.y+"px",this.dom.scrollLeft=0,this.dom.scrollTop=0)}get popUpButtonAnimationData(){if(!this._fromButton)return null;let{x:e,y:t,width:i,height:s}=this._contextView.cell.dom.getBoundingClientRect();return e+=window.scrollX,t+=window.scrollY,{rect:{x:e,y:t,width:i,height:s},index:-1===this._hotIndex?this._initialIndex:this._hotIndex}}openAround(e,t,i,s=!1){0!==this._flashTimer&&(clearInterval(this._flashTimer),this._flashTimer=0),this._updateDirtyItems(),this._opaque=!0,this._allowsUpdate=!0;let n=this.window;null===n&&(n=new _HIMenuWindow(this));let r=0;s&&(r=i.cell.dom.getBoundingClientRect().width,r+=8),n.appearance=i.effectiveAppearance,n.openAround(e,t,r),n._claimMouseSession(this,i.window)?(this._mouseDownAt=HIEvent.current.native.timeStamp,this._mouseOnceReleased=!1):(this._mouseDownAt=-1,this._mouseOnceReleased=!0),this._initialIndex=t,this._contextView=i,this.dom.classList.remove("fading-state-column"),this._fromButton=s,s?(null===this._buttonCapDOM&&(this._buttonCapDOM=document.createElement("div"),this._buttonCapDOM.classList.add("hi-menu-backdrop","button-cap"),this._buttonCapDOM.innerHTML=le+he,this.dom.appendChild(this._buttonCapDOM)),this._buttonCapDOM.style.left="auto",this._buttonCapDOM.style.width="16px"):null!==this._buttonCapDOM&&(this._buttonCapDOM.remove(),this._buttonCapDOM=null),this._highlightItemAt(t,!0),HINotificationCenter.default.post(HIMenu.didBeginTrackingNotification,this._menu)}closeAnimated(e,t=-1){var i;if(!this._opaque)return;this._opaque=!1,this._allowsUpdate=!1,this._hotIndex=t,this._highlightItemAt(-1);let s=this._fromButton,n=()=>{s&&this.dom.classList.add("fading-state-column"),this.window.orderOut(),this._contextView=null,HINotificationCenter.default.post(HIMenu.didEndTrackingNotification,this._menu)};if(-1===t)n();else{let e=null===(i=this._contextView)||void 0===i?void 0:i.window,r=this._rows[t].item,o=s?2:1,a=100/o;this._flashTimer=setInterval(()=>{var i;if((null===(i=this._rows[t])||void 0===i?void 0:i.item)===r){if(-1===this._highlightedIndex?this._highlightItemAt(t):this._highlightItemAt(-1),o-=1,0!==o)return;null!==r.action&&r.isEnabled&&(HINotificationCenter.default.post(HIMenu.willSendActionNotification,this._menu,r),null==e||e.sendAction(r.action,r.target,r),HINotificationCenter.default.post(HIMenu.didSendActionNotification,this._menu,r))}else this._hotIndex=-1,this._initialIndex=-1;clearInterval(this._flashTimer),this._flashTimer=0,n()},a)}}_highlightItemAt(e,t=!1){var i,s;let n=this._highlightedIndex;if(n===e&&!t)return;-1!==n&&(null===(i=this._rows[n].cell)||void 0===i||i.setHighlighted(!1));let r=0,o=0;if(-1!==e&&(null===(s=this._rows[e].cell)||void 0===s||s.setHighlighted(!0),r=this._rows[e].dom.offsetTop,o=this._rows[e].dom.offsetHeight),this._highlightedIndex=e,0===o)this._highlightDOM.style.top="0",this._highlightDOM.style.height="1px",this._highlightDOM.style.display="none",this._highlightDOM.style.clipPath="",this._backdropDOM.style.clipPath="";else{let e=this.window.frame.height,t=this.originOutset.y;const i=4;r-i<t?this.originOutset={x:0,y:r-i}:r+o+i>t+e&&(this.originOutset={x:0,y:r+o+i-e}),this._highlightDOM.style.top=r-5+"px",this._highlightDOM.style.height=o+10+"px",this._highlightDOM.style.clipPath="inset(5px 0 5px 0)",this._highlightDOM.style.display="",this._backdropDOM.style.clipPath="polygon(0 0, w 0, w h, 0 h, 0 b, w b, w t, 0 t)".replace(/(w|h|t|b)/g,e=>{switch(e){case"w":case"h":return"100%";case"t":return r+"px";case"b":return r+o+"px";default:return e}})}}_enabledIndexFor(e){let t=function(e,t){let i=e,s=i.parentNode;for(;null!==s&&s!==t;)i=s,s=i.parentNode;return s===t?i:null}(e.native.target,this._contentDOM),i=null===t?-1:this._rows.findIndex(e=>e.dom===t);return-1!==i&&this._rows[i].item.isEnabled?i:-1}get hotIndex(){return this._hotIndex}mouseDown(e){this._opaque&&this._highlightItemAt(this._enabledIndexFor(e))}mouseDragged(e){this._opaque&&this._highlightItemAt(this._enabledIndexFor(e))}mouseUp(e){if(!this._opaque)return;let t=this._enabledIndexFor(e);this._highlightItemAt(t);this._mouseOnceReleased?-1!==t&&this.closeAnimated(!0,t):e.native.timeStamp-this._mouseDownAt>300&&this.closeAnimated(!0,t),this._mouseOnceReleased=!0}mouseMoved(e){this._opaque&&this._highlightItemAt(this._enabledIndexFor(e))}mouseEntered(e){if(!this._opaque)return;let t=this._enabledIndexFor(e);-1!==t&&this._highlightItemAt(t)}mouseExited(e){this._opaque&&this._highlightItemAt(-1)}scrollWheel(e){if(!this._opaque)return;this._accDelta+=e.native.deltaY;let t=Math.trunc(this._accDelta/19);this.dom.scrollTop+=19*t,this._accDelta-=19*t}keyDown(e){let t=-1;switch(e.native.key){case" ":case"Enter":return this.closeAnimated(!0,this._highlightedIndex);case"Escape":return this.closeAnimated(!0);case"ArrowUp":for(t=-1===this._highlightedIndex?this._rows.length:this._highlightedIndex;t>0&&(t-=1,!this._rows[t].item.isEnabled););break;case"ArrowDown":for(t=this._highlightedIndex;t<this._rows.length-1&&(t+=1,!this._rows[t].item.isEnabled););break;default:1!==e.native.key.length||e.isMetaKeyDown||(t=this._menu.indexOfItemForCharacter(e.native.key,this._highlightedIndex+1))}-1!==t&&this._highlightItemAt(t)}acceptsFirstMouse(e){return!0}get acceptsFirstResponder(){return!0}}class _HIMenuWindow extends HIWindow{constructor(e){super(),this.level=20,this.backgroundColor=HIColor.clear,this.contentView=e,this._frameView.frameDOM.classList.add("hi-menu-window"),this._savedKeyWindow=null}openAround(e,t,i){let s=this.contentView,n=HIWindow.visibleViewportFrame,r=n.x+oe,o=n.y+oe,a=n.x+n.width-oe,l=n.y+n.height-oe,{x:h,y:d}=e,u=null,{width:c,height:_}=N(s.dom,e=>(e.width=Math.max(e.width,i),-1!==t&&(u=s.offsetOfItemAt(t)),e));c=Math.min(Math.ceil(c),a-r),_=Math.min(Math.ceil(_),l-o),null!==u?(h-=u.x,d-=u.y):(h+c>a&&(h=e.x+e.width-c),d+=e.height,d+_>l&&(d=e.y-_)),h<r?h=r:h+c>a&&(h=a-c),d<o?d=o:d+_>l&&(d=l-_),this.contentView=s,this.frame={x:h,y:d,width:c,height:_},this.makeKeyAndOrderFront(),null!==u&&(s.originOutset={x:0,y:d+u.y-e.y})}closingAnimator(){let e=this.contentView,t=e.popUpButtonAnimationData;if(null===t)return HIAnimator.frameByFrame(200,e=>{let t=1-e.value;this._frameView.frameDOM.style.opacity=t.toString()}).thenOrCatch(()=>{this._frameView.frameDOM.style.opacity="1"});{let{x:i,y:s}=this.frame,n=e.offsetOfItemAt(t.index).y,r=s-e.originOutset.y+n,o=t.rect.y,a=new HIRectInterpolation(this.frame,t.rect);return HIAnimator.frameByFrame(200,t=>{let s=t.value,l=T(a.rectAt(s)),h=R(r+(o-r)*s);this.frame=l,e.originOutset={x:l.x-i,y:l.y+n-h}}).thenOrCatch(()=>{e.originOutset={x:0,y:0}})}}get wantsModalWhenKey(){return!0}modalMouseDownOutsideWindow(e){this.contentView.closeAnimated(!0)}becomeKeyWindow(){if(this._savedKeyWindow=HIWindow.keyWindow,super.becomeKeyWindow(),null!==this._savedKeyWindow){let e=this._savedKeyWindow.isMainWindow;this._savedKeyWindow._frameView.setKeyOrMainAppearance(!0,e)}}resignKeyWindow(){if(super.resignKeyWindow(),null!==this._savedKeyWindow){let e=this._savedKeyWindow.isKeyWindow,t=this._savedKeyWindow.isMainWindow;this._savedKeyWindow._frameView.setKeyOrMainAppearance(e,t),this._savedKeyWindow=null}}}const oe=6,ae=21;class _HIMenuItemCell{constructor(){this.dom=document.createElement("div"),this.dom.classList.add("hi-menu-item-cell"),this._titleDOM=document.createElement("span"),this._titleDOM.classList.add("hi-menu-item-title"),this.dom.appendChild(this._titleDOM),this._imageDOM=null,this._stateImageDOM=null}update(e){switch(e._changedKey){case"title":this.setTitle(e.title);break;case"image":this.setImage(e.image);break;case"state":this.setState(e.state,e.imageFor(e.state));break;case"isEnabled":this.setEnabled(e.isEnabled);break;case null:this.setTitle(e.title),this.setImage(e.image),this.setState(e.state,e.imageFor(e.state)),this.setEnabled(e.isEnabled)}}setTitle(e){this._titleDOM.textContent=e}setImage(e){if(null===e)null!==this._imageDOM&&(this.dom.removeChild(this._imageDOM),this._imageDOM=null);else{let t=e.makeDOM();t.classList.add("hi-menu-item-image"),null===this._imageDOM?this._titleDOM.before(t):this._imageDOM.replaceWith(t),this._imageDOM=t}}setState(e,t){if(h(this.dom,e),null===t)null!==this._stateImageDOM&&(this.dom.removeChild(this._stateImageDOM),this._stateImageDOM=null);else{let e=t.makeDOM();e.classList.add("hi-menu-state-image"),null===this._stateImageDOM?this.dom.prepend(e):this._stateImageDOM.replaceWith(e),this._stateImageDOM=e}}setHighlighted(e){l(this.dom,"highlighted",e)}setEnabled(e){l(this.dom,"disabled",!e)}}const le='<svg viewBox="0 0 16 19" class="hi-menu-button-cap-arrow-glyph top" xmlns="http://www.w3.org/2000/svg"><path d="M5.15 7.35l3.1-3.1 3.1 3.05" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.35" fill="none"/></svg>',he='<svg viewBox="0 0 16 19" class="hi-menu-button-cap-arrow-glyph bottom" xmlns="http://www.w3.org/2000/svg"><path d="M5.15 11.65l3.1 3.1 3.1-3.1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.35" fill="none"/></svg>';class HIPopUpButtonCell extends HIButtonCell{constructor(){super(),this.dom.classList.add("hi-pop-up-button-cell"),this.dom.children[0].classList.add("hi-pop-up-button-bezel"),this._arrowDOM=document.createElement("span"),this._arrowDOM.classList.add("hi-pop-up-button-arrow"),this.dom.appendChild(this._arrowDOM),this._pullsDown=!1,this._arrowDOM.innerHTML=de,this.alignment=0}get pullsDown(){return this._pullsDown}set pullsDown(e){e!==this._pullsDown&&(this._pullsDown=e,this._arrowDOM.innerHTML=e?ue:de)}}const de='<svg viewBox="0 0 16 19" class="hi-pop-up-button-arrow-glyph" xmlns="http://www.w3.org/2000/svg"><path d="M5.15 11.65l3.1 3.1 3.1-3.1m-6.2-4.3l3.1-3.1 3.1 3.05" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.35" fill="none"/></svg>',ue='<svg viewBox="0 0 16 19" class="hi-pop-up-button-arrow-glyph" xmlns="http://www.w3.org/2000/svg"><path d="M5.15 8.05l3.1 3.1 3.1-3.1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.35" fill="none"/></svg>';class HIPopUpButton extends HIButton{constructor(e,t,i=!1){super("",e,t),this.cell.pullsDown=i,this._title="",this._image=null,this._menu=new HIMenu,this._itemIndex=-1,HINotificationCenter.default.addObserver(this,"menuDidAddItem",HIMenu.didAddItemNotification,this._menu),HINotificationCenter.default.addObserver(this,"menuDidRemoveItem",HIMenu.didRemoveItemNotification,this._menu),HINotificationCenter.default.addObserver(this,"menuDidChangeItem",HIMenu.didChangeItemNotification,this._menu),HINotificationCenter.default.addObserver(this,"menuDidClose",HIMenu.didEndTrackingNotification,this._menu)}static makeDOM(){let e=super.makeDOM();return e.classList.add("hi-pop-up-button"),e}static makeCell(){return new HIPopUpButtonCell}get title(){return this._title}set title(e){this._title=e,this.cell.pullsDown&&(super.title=e)}get image(){return this._image}set image(e){this._image=e,this.cell.pullsDown&&(super.image=e)}get menu(){return this._menu}addItem(e){this._menu.addItem(e,null)}_syncTitleAndImage(){if(this.cell.pullsDown)super.title=this._title,super.image=this._image;else if(-1===this._itemIndex)super.title="",super.image=null;else{let e=this._menu.items[this._itemIndex];super.title=e.title,super.image=e.image}}_selectItemAt(e){let t=this._itemIndex;if(e!==t&&(this._itemIndex=e,!this.cell.pullsDown)){if(this._syncTitleAndImage(),-1!==t){this._menu.items[t].state=0}if(-1!==e){this._menu.items[e].state=1}}}get pullsDown(){return this.cell.pullsDown}set pullsDown(e){e!==this.cell.pullsDown&&(this.cell.pullsDown=e,e||1!==this._itemIndex||0===this._menu.items.length?e&&-1!==this._itemIndex?(this._syncTitleAndImage(),this._menu.items[this._itemIndex].state=0):this._syncTitleAndImage():this._selectItemAt(0))}get indexOfSelectedItem(){return this._itemIndex}set indexOfSelectedItem(e){if(e<-1||e>=this._menu.items.length)throw new RangeError("Index out of range.");this._selectItemAt(e)}menuDidAddItem(e){if(e.sender!==this._menu)return;let t=e.userInfo;t<=this._itemIndex?this._itemIndex+=1:-1!==this._itemIndex||this.pullsDown||this._selectItemAt(t)}menuDidRemoveItem(e){if(e.sender!==this._menu)return;let t=e.userInfo;t===this._itemIndex?(this._itemIndex=-1,this._syncTitleAndImage()):t<this._itemIndex&&(this._itemIndex-=1)}menuDidChangeItem(e){if(e.sender!==this._menu)return;e.userInfo===this._itemIndex&&this._syncTitleAndImage()}menuDidClose(e){e.sender===this._menu&&(this.cell.isHighlighted=!1)}_openMenu(){if(0!==this._menu.items.length){this.cell.isHighlighted=!0;for(let e of this._menu.items)null!==e.action||null!==e.target||e.isSeparator||(e.action="_popUpItemAction",e.target=this);this._menu._popUpPopUpButton(this)}}_popUpItemAction(e){this._menu.items.indexOf(e),this._selectItemAt(this._menu.items.indexOf(e)),null!==this.action&&this.sendAction(this.action,this.target)}mouseDown(e){if(!this.isEnabled)return super.mouseDown(e);this._openMenu()}mouseDragged(e){if(!this.isEnabled)return super.mouseDown(e)}mouseUp(e){if(!this.isEnabled)return super.mouseUp(e)}performClick(e){this.isEnabled&&this._openMenu()}}let ce=null;class HIScroller extends HIControl{constructor(e=!1){super(),this._value=0,this._knobProportion=0,this.dom.classList.add(e?"horizontal":"vertical"),this._horizontal=e,this._style=-1,this.style=HIScroller.preferredScrollerStyle,this._trackDOM=document.createElement("div"),this._trackDOM.classList.add("hi-scroller-track"),this.dom.appendChild(this._trackDOM),this._knobDOM=document.createElement("div"),this._knobDOM.classList.add("hi-scroller-knob"),this.dom.appendChild(this._knobDOM),this._mouseDrag=null,this._activeCount=0,this._delayedIdel=0,this.dom.classList.add("idle"),this.isContinuous=!0,this._updateKnobPosition()}static makeDOM(){let e=document.createElement("span");return e.classList.add("hi-scroller"),e}static get preferredScrollerStyle(){if(null===ce){let e=document.createElement("div");e.style.width="30px",e.style.height="30px",e.style.overflow="scroll",e.style.visibility="hidden",e.style.position="absolute";let t=document.createElement("div");t.style.width="40px",t.style.height="40px",e.appendChild(t),document.body.appendChild(e),ce=e.offsetWidth===e.clientWidth?1:0}return ce}static set preferredScrollerStyle(e){ce!==e&&(ce=e,HINotificationCenter.default.post(HIScroller.preferredScrollerStyleDidChangeNotification,null))}get scrollerWidth(){return 16}get style(){return this._style}set style(e){this._style!==e&&(this._style=e,this.dom.classList.toggle("overlay",1===e))}get value(){return this._value}set value(e){let t=Math.min(1,Math.max(0,e));this._value!==t&&(this._value=t,this._updateKnobPosition())}get knobProportion(){return this._knobProportion}set knobProportion(e){let t=Math.min(1,Math.max(0,e));this._knobProportion!==t&&(this._knobProportion=t,this._updateKnobPosition(),this.dom.classList.toggle("full",1===t))}_updateKnobPosition(){let e=this._value,t=this._knobProportion,i=this._horizontal?this.dom.clientWidth:this.dom.clientHeight,s=i*t;s=Math.max(20,s);let n=e*(i-s);this.dom.style.setProperty("--knob-offset",n+"px"),this.dom.style.setProperty("--knob-size",s+"px"),this.noteActive()}_updateValue(e){let t=this._horizontal?e.native.clientX:e.native.clientY,{min:i,max:s}=this._mouseDrag,n=(t-i)/(s-i);n=Number.isFinite(n)?Math.min(1,Math.max(0,n)):0,this._value=n,this._updateKnobPosition()}noteActive(){0===this._activeCount&&(this._delayedIdel||(this.dom.classList.remove("idle"),this._delayedIdel=setTimeout(()=>{this._delayedIdel=0,this.dom.classList.add("idle")})))}beginTracking(){this._delayedIdel?clearTimeout(this._delayedIdel):this.dom.classList.remove("idle"),this._activeCount+=1}endTracking(){this._activeCount-=1,0===this._activeCount&&(this._delayedIdel=setTimeout(()=>{this._delayedIdel=0,this.dom.classList.add("idle")}))}mouseDown(e){if(!this.isEnabled)return super.mouseDown(e);let t=e.native.target===this._knobDOM,i=this._horizontal?"x":"y",s=this._horizontal?"width":"height",n=this.dom.getBoundingClientRect(),r=this._knobDOM.getBoundingClientRect(),o=n[i]+r[s]/2,a=n[i]+n[s]-r[s]/2;if(this.beginTracking(),l(this.dom,"highlighted",!0),this._mouseDrag={min:o,max:a,once:!1},t){let t=this._horizontal?e.native.clientX:e.native.clientY,n=r[i]+r[s]/2-t;return this._mouseDrag.min-=n,void(this._mouseDrag.max-=n)}this._updateValue(e),this.isContinuous&&null!==this.action&&this.sendAction(this.action,this.target)}mouseDragged(e){if(null===this._mouseDrag)return super.mouseDragged(e);this._updateValue(e),this._mouseDrag.once=!0,this.isContinuous&&null!==this.action&&this.sendAction(this.action,this.target)}mouseUp(e){if(null===this._mouseDrag)return super.mouseDragged(e);this.endTracking(),l(this.dom,"highlighted",!1),this._mouseDrag.once&&(this._updateValue(e),this._mouseDrag=null,null!==this.action&&this.sendAction(this.action,this.target))}get acceptsFirstResponder(){return!1}acceptsFirstMouse(e){return 0===this._style}layout(){this._updateKnobPosition()}}HIScroller.preferredScrollerStyleDidChangeNotification="preferredScrollerStyleDidChange",HIAppearance.addCSSVariableProvider("--hi-scroller-lecacy-color",e=>e.isDark?"#2b2b2b":"#fafafa"),HIAppearance.addCSSVariableProvider("--hi-scroller-overlay-color",e=>e.isDark?"rgba(255, 255, 255, 0.12)":"rgba(250, 250, 250, 0.75)"),HIAppearance.addCSSVariableProvider("--hi-scroller-knob-color",e=>e.isDark?"rgba(255, 255, 255, 0.5)":"rgba(0, 0, 0, 0.5)"),HIAppearance.addCSSVariableProvider("--hi-scroller-knob-border-color",e=>e.isDark?"rgba(0, 0, 0, 0.15)":"rgba(255, 255, 255, 0.15)");class HISlider extends HIControl{constructor(e,t,i,s,n){super(),this._value=Math.min(i,Math.max(t,e)),this._minValue=t,this._maxValue=i,this.target=s,this.action=n,this._trackDOM=document.createElement("div"),this._trackDOM.classList.add("hi-slider-track"),this.dom.appendChild(this._trackDOM),this._knobDOM=document.createElement("div"),this._knobDOM.classList.add("hi-slider-knob"),this.dom.appendChild(this._knobDOM),this._mouseDrag=null,this._updateKnobPosition()}static makeDOM(){let e=document.createElement("div");return e.classList.add("hi-slider"),e}get value(){return this._value}set value(e){this._value!==e&&(this._value=Math.min(this._maxValue,Math.max(this._minValue,e)),this._updateKnobPosition())}get minValue(){return this._minValue}set minValue(e){this._minValue!==e&&(this._minValue=e,this._updateKnobPosition())}get maxValue(){return this._maxValue}set maxValue(e){this._maxValue!==e&&(this._maxValue=e,this._updateKnobPosition())}_updateKnobPosition(){let e=(this._value-this._minValue)/(this._maxValue-this._minValue);Number.isFinite(e)||(e=0),this.dom.style.setProperty("--percentage",100*e+"%"),this.dom.style.setProperty("--progress",e.toString()),this.noteFocusRingChanged()}_updateValue(e){let{minX:t,maxX:i}=this._mouseDrag,s=(e.native.clientX-t)/(i-t);s=Number.isFinite(s)?Math.min(1,Math.max(0,s)):0,this._value=this._minValue+s*(this._maxValue-this._minValue),this._updateKnobPosition()}mouseDown(e){if(!this.isEnabled)return super.mouseDown(e);let t=e.native.target===this._knobDOM,i=this._trackDOM.getBoundingClientRect(),s=this._knobDOM.getBoundingClientRect(),n=i.x+s.width/2,r=i.x+i.width-s.width/2;if(l(this._knobDOM,"highlighted",!0),this._mouseDrag={minX:n,maxX:r,once:!1},t){let t=e.native.clientX,i=s.x+s.width/2-t;return this._mouseDrag.minX-=i,void(this._mouseDrag.maxX-=i)}this._updateValue(e),this.isContinuous&&null!==this.action&&this.sendAction(this.action,this.target)}mouseDragged(e){if(null===this._mouseDrag)return super.mouseDragged(e);this._updateValue(e),this._mouseDrag.once=!0,this.isContinuous&&null!==this.action&&this.sendAction(this.action,this.target)}mouseUp(e){if(null===this._mouseDrag)return super.mouseDragged(e);l(this._knobDOM,"highlighted",!1),this._mouseDrag.once&&(this._updateValue(e),this._mouseDrag=null,null!==this.action&&this.sendAction(this.action,this.target))}keyDown(e){let t=this._value;switch(e.native.key){case"ArrowLeft":case"ArrowDown":t-=.05*(this._maxValue-this._minValue);break;case"ArrowRight":case"ArrowUp":t+=.05*(this._maxValue-this._minValue);break;default:return super.keyDown(e)}t=Math.min(this._maxValue,Math.max(this._minValue,t)),this._value=t,this._updateKnobPosition(),null!==this.action&&this.sendAction(this.action,this.target)}get keyDOM(){return this._knobDOM}}class HIViewController extends HIResponder{constructor(){super(...arguments),this._title="",this._view=null,this._parent=null,this._children=[],this._presented=null,this._presenting=null}get title(){return this._title}set title(e){this._title=e}get isViewLoaded(){return null!==this._view}get view(){if(null===this._view&&(this.loadView(),null===this._view))throw new Error("No view is set from `loadView`.");return this._view}set view(e){let t=null!==this._view;t&&this._view._setDelegate(null),this._view=e,this._view._setDelegate(this),t||this.viewDidLoad()}loadView(){this.view=new HIView}viewDidLoad(){}get nextResponder(){return this._view._nextResponderIgnoringDelegate}get parent(){return this._parent}get children(){return this._children}addChild(e){this.insertChild(e,this._children.length)}insertChild(e,t){null!==e._parent&&e.removeFromParent(),e._parent=this,this._children.splice(t,0,e)}removeFromParent(){if(null===this._parent)return;let e=this._parent._children.indexOf(this);this._parent._children.splice(e,1),this._parent=null}viewWillAppear(){}viewDidAppear(){}viewWillDisappear(){}viewDidDisappear(){}get presented(){let e=this;for(;null===e._presented&&null!==e._parent;)e=e._parent;return e._presented}get presenting(){return this._presenting}}class AppearanceAdjustViewController extends HIViewController{_sliders;_systemCheckbox;_systemPopUp;_useHSL;_useDark;_color;_actionSentBySlider;static rgbCompNames=["Red","Green","Blue"];static hslCompNames=["Hue","Sat","Light"];static systemColors=["Blue","Purple","Pink","Red","Orange","Yellow","Green","Gray"].map(e=>({name:e,color:HIColor["system"+e]}));loadView(){let e=new HIBox;this.view=e,e.contentInsets={minX:20,minY:20,maxX:20,maxY:20},this._sliders=AppearanceAdjustViewController.rgbCompNames.map((t,i)=>{let s=new HILabel(t+":");s.alignment=2;let n=e.addSubview(s);n.x=-10,n.y=25*i,n.width=50;let r=new HISlider(0,0,1,this,"takeSliderValue");r.isContinuous=!0;let o=e.addSubview(r);return o.x=n.maxX+12,o.y=n.y,o.width=220,o.autoresizingMask=2,r});let t=new HILabel("Mode:");t.alignment=2;let i=e.addSubview(t);i.x=-10,i.y=80,i.width=50,this._useHSL=!1;let s=HIButton.radioButton("RGB",this,"useColorMode");s.state=1,s.tag=0;let n=e.addSubview(s);n.x=i.maxX+10,n.y=i.y;let r=HIButton.radioButton("HSL",this,"useColorMode");r.tag=1;let o=e.addSubview(r);o.x=n.maxX+10,o.y=i.y,this._systemCheckbox=HIButton.checkbox("Use System Color",this,"toggleSystem"),this._systemCheckbox.state=1;let a=e.addSubview(this._systemCheckbox);a.x=n.x,a.y=105,this._systemPopUp=new HIPopUpButton(this,"updateSystemColor");for(let{name:e}of AppearanceAdjustViewController.systemColors)this._systemPopUp.addItem(e);this._color=AppearanceAdjustViewController.systemColors[0].color,this._systemPopUp.indexOfSelectedItem=0;let l=e.addSubview(this._systemPopUp);l.x=a.maxX+4,l.y=a.y,l.width=270-l.x,this._darkCheckbox=HIButton.checkbox("Dark Appearance",this,"toggleDark");let h=e.addSubview(this._darkCheckbox);h.x=a.x,h.y=130}static convertToHSL([e,t,i]){let s,n,r=Math.max(e,t,i),o=Math.min(e,t,i),a=r-o,l=(r+o)/2;if(0===a)s=n=0;else{let h=r+o;switch(n=l>.5?a/(2-h):a/h,r){case e:s=(t-i)/a+(t<i?6:0);break;case t:s=(i-e)/a+2;break;case i:s=(e-t)/a+4}s/=6}return[s,n,l]}static convertToRGB([e,t,i]){e%=1;let s,n,r,o=(1-Math.abs(2*i-1))*t,a=o*(1-Math.abs(6*e%2-1)),l=i-o/2;switch(Math.floor(6*e)){case 0:s=o,n=a,r=0;break;case 1:s=a,n=o,r=0;break;case 2:s=0,n=o,r=a;break;case 3:s=0,n=a,r=o;break;case 4:s=a,n=0,r=o;break;case 5:s=o,n=0,r=a}return[s+l,n+l,r+l]}viewWillAppear(){this._useDark=HIAppearance.system.isDark,this._darkCheckbox.state=this._useDark?1:0,this._actionSentBySlider=!1,this.commitAppearance()}viewWillDisappear(){HIAppearance.system=null}commitAppearance(){let e=(this._useDark?HIAppearance.darkAqua:HIAppearance.aqua).withAccentColor(this._color);if(HIAppearance.system=e,this._actionSentBySlider)return;let t=this._color.resolved(e).components;this._useHSL&&(t=AppearanceAdjustViewController.convertToHSL(t));for(let e=0;e<3;++e)this._sliders[e].value=t[e]}useColorMode(e){let t,i=1===e.tag;if(i===this._useHSL)return;this._useHSL=i;let s=this._sliders.map(e=>e.value);i?(t=AppearanceAdjustViewController.hslCompNames,s=AppearanceAdjustViewController.convertToHSL(s)):(t=AppearanceAdjustViewController.rgbCompNames,s=AppearanceAdjustViewController.convertToRGB(s));for(let e=0;e<3;++e)this.view.subviews[2*e].string=t[e]+":",this._sliders[e].value=s[e]}takeSliderValue(e){this._actionSentBySlider=!0,this.updateCustomColor(e),this._actionSentBySlider=!1}updateCustomColor(e){let t=this._sliders.map(e=>e.value);this._useHSL&&(t=AppearanceAdjustViewController.convertToRGB(t)),this._color=HIColor.fromComponents(t[0],t[1],t[2]),this._systemCheckbox.state=0,this.commitAppearance()}updateSystemColor(e){let t=this._systemPopUp.indexOfSelectedItem;this._color=AppearanceAdjustViewController.systemColors[t].color,this._systemCheckbox.state=1,this.commitAppearance()}toggleSystem(e){this._systemCheckbox.state?this.updateSystemColor(e):this.updateCustomColor(e)}toggleDark(e){this._useDark=1===e.state,this.commitAppearance()}}let _e=new HIWindow;_e.title="Appearance Adjust",_e.styleMask=11,_e.contentViewController=new AppearanceAdjustViewController,_e.minSize=_e.frame;class SimplePathView extends HIDrawingView{_backgroundColor;_foregroundColor;_polylines;_lineWidth;delegate;constructor(){super(),this._backgroundColor=HIColor.textBackground,this._foregroundColor=HIColor.controlAccent,this._polylines=[],this._lineWidth=4,this.delegate=null}didChangeEffectiveAppearance(){this.delegate?.viewDidChangeEffectiveAppearance(this)}drawRect(e,t){t.fillStyle=this._backgroundColor.cssColor,t.fillRect(e.x,e.y,e.width,e.height),t.lineWidth=this._lineWidth,t.lineCap="round",t.lineJoin="round";for(let e of this._polylines){t.strokeStyle=e.color.cssColor,t.beginPath();for(let i=0;i<e.length;i++){let{x:s,y:n}=e[i];0===i?t.moveTo(s,n):t.lineTo(s,n)}t.stroke()}}mouseDown(e){this.beginPath(),this._addPointWithEvent(e)}mouseDragged(e){this._addPointWithEvent(e)}mouseUp(e){this._addPointWithEvent(e),this.delegate?.viewDidEndDrawing(this)}_addPointWithEvent(e){let{clientX:t,clientY:i}=e.native,{x:s,y:n,width:r,height:o}=this.dom.getBoundingClientRect();t=Math.max(0,Math.min(t-s,r)),i=Math.max(0,Math.min(i-n,o)),this.addPoint(t,i)}beginPath(){let e=[];e.color=this._foregroundColor,this._polylines.push(e)}addPoint(e,t){let i=this._polylines[this._polylines.length-1],s=i[i.length-1];if(i.push({x:e,y:t}),void 0===s)i.pointBounds={x:e,y:t,width:0,height:0},this.setNeedsDisplay();else{let i=Math.min(s.x,e),n=Math.min(s.y,t),r={x:i,y:n,width:Math.max(s.x,e)-i,height:Math.max(s.y,t)-n};r.x-=this._lineWidth/2,r.y-=this._lineWidth/2,r.width+=this._lineWidth,r.height+=this._lineWidth,this.setNeedsDisplay(r)}}clear(e){this._polylines.length=0,this.setNeedsDisplay()}get isEmpty(){return 0===this._polylines.length}get backgroundColor(){return this._backgroundColor}set backgroundColor(e){this._backgroundColor=e,this.setNeedsDisplay()}get foregroundColor(){return this._foregroundColor}set foregroundColor(e){this._foregroundColor=e}}class SimplePathViewController extends HIViewController{_pathView;_clearButton;_colorPopUp;static foregroundColors=[{name:"Default",color:HIColor.text},{name:"Accent",color:HIColor.controlAccent},{name:"Red",color:HIColor.systemRed},{name:"Orange",color:HIColor.systemOrange},{name:"Yellow",color:HIColor.systemYellow},{name:"Green",color:HIColor.systemGreen},{name:"Teal",color:HIColor.systemTeal},{name:"Blue",color:HIColor.systemBlue},{name:"Indigo",color:HIColor.systemIndigo},{name:"Purple",color:HIColor.systemPurple},{name:"Pink",color:HIColor.systemPink},{name:"Brown",color:HIColor.systemBrown},{name:"Gray",color:HIColor.systemGray}];static initialPaths=[[HIColor.systemGreen,26,184,63,169,108,130,108,109,108,98,104,96,99,96,84,96,81,117,67,204],[HIColor.systemYellow,67,204,71,174,79,153,97,153,109,153,115,159,115,166,115,171,110,177,110,186,110,201,117,205,124,205,132,205,141,201,148,196],[HIColor.systemOrange,148,196,158,188,167,178,167,169,167,163,165,151,154,151,143,151,139,162,139,173,139,187,148,202,163,202,175,202,187,195,197,184],[HIColor.systemRed,199,183,214,167,224,143,224,126,224,102,220,98,213,98,204,98,194,113,194,154,194,187,204,200,217,200,231,200,243,193,252,182],[HIColor.systemPurple,252,183,268,165,278,138,278,119,278,104,274,97,267,97,254,97,244,123,244,153,244,179,259,199,275,199,286,199,295,189,296,183],[HIColor.controlAccent,333,161,349,206,299,208,296,182,298,152,321,146,333,161,344,165,354,162,364,153],[HIColor.text,348,198,348,198,349,199,350,199]];loadView(){let e=new HIBox;this.view=e,e.contentInsets.maxY=20,this._pathView=new SimplePathView,this._pathView.delegate=this;let t=e.addSubview(this._pathView);t.width=400,t.height=300,t.autoresizingMask=18,this._clearButton=new HIButton("Clear",this,"clearOrLoad");let i=e.addSubview(this._clearButton);i.x=100,i.y=320,i.width=90,i.autoresizingMask=13,this._colorPopUp=new HIPopUpButton(this,"takeColor");for(let{name:e}of SimplePathViewController.foregroundColors)this._colorPopUp.addItem(e);let s=e.addSubview(this._colorPopUp);s.x=210,s.y=320,s.width=90,s.autoresizingMask=13,this.takeColor(this._colorPopUp),this._updateDefaultColorName(),this._loadInitialPaths()}_updateDefaultColorName(){let e=this._pathView.effectiveAppearance.isDark;this._colorPopUp.menu.items[0].title=e?"White":"Black"}_loadInitialPaths(){for(let e of SimplePathViewController.initialPaths){this._pathView.foregroundColor=e[0],this._pathView.beginPath();let t=e[1],i=e[2];for(let s=3;s<e.length;s+=6){let n=e[s],r=e[s+1],o=e[s+2],a=e[s+3],l=e[s+4],h=e[s+5],d=+Math.hypot(n-t,r-i)+Math.hypot(o-n,a-r)+Math.hypot(l-o,h-a),u=Math.ceil(d/2);for(let e=0;e<u;++e){let s=e/u,d=Math.pow(1-s,3)*t+3*Math.pow(1-s,2)*s*n+3*(1-s)*Math.pow(s,2)*o+Math.pow(s,3)*l,c=Math.pow(1-s,3)*i+3*Math.pow(1-s,2)*s*r+3*(1-s)*Math.pow(s,2)*a+Math.pow(s,3)*h;this._pathView.addPoint(d,c)}t=l,i=h}}}clearOrLoad(e){this._pathView.isEmpty?(this._loadInitialPaths(),e.title="Clear"):(this._pathView.clear(),e.title="Draw Hello")}takeColor(e){let t=SimplePathViewController.foregroundColors[e.indexOfSelectedItem].color;this._pathView.foregroundColor=t}viewDidEndDrawing(e){this._clearButton.title="Clear"}viewDidChangeEffectiveAppearance(e){this._updateDefaultColorName()}}let me=new HIWindow;me.title="Quick Draw",me.styleMask=11,me.contentViewController=new SimplePathViewController,_e.frame.x=100,_e.frame.y=100,_e.makeKeyAndOrderFront(),me.frame.x=200,me.frame.y=350,me.makeKeyAndOrderFront()}();
